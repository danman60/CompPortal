# Codex Tasks for CompPortal

This directory manages tasks delegated to Codex (junior dev) for parallel processing while Claude handles architecture and complex implementation.

## Directory Structure

```
codex-tasks/
‚îú‚îÄ‚îÄ README.md           # This file
‚îú‚îÄ‚îÄ outputs/            # Generated code from Codex
‚îú‚îÄ‚îÄ logs/               # Task execution logs
‚îú‚îÄ‚îÄ migrations/         # Generated migration files
‚îú‚îÄ‚îÄ blockers/           # Issues requiring Claude intervention
‚îî‚îÄ‚îÄ [TASK_NAME].md     # Task specifications for Codex
```

## Workflow

### 1. Claude Creates Task (Senior Dev)

When Claude identifies a suitable task for delegation:

```markdown
// codex-tasks/create_entry_form.md

## Task: Create Entry Form Component

**Context:**
- File: src/components/EntryForm.tsx
- Pattern: Glassmorphic design (bg-white/10 backdrop-blur-md)
- Form fields: routine_title, dance_category, entry_participants
- Submit: Call tRPC mutation `entry.create`

**Requirements:**
1. Use React Hook Form with Zod validation
2. Match existing UI patterns from EntriesList.tsx
3. Error handling with toast notifications
4. Loading states on submission
5. Disable submit button during loading

**Prisma Schema Reference:**
Entry model fields: id, competition_id, studio_id, routine_title, dance_category, entry_participants, music_file_url, status, created_at

**Deliverables:**
- Complete EntryForm.tsx component
- Export default EntryForm
- Follow glassmorphic pattern
- Include prop types if needed

**Validation:**
- Build must succeed
- Component follows design system
- Form has proper validation
```

### 2. User Runs Codex (Parallel)

User runs Codex with the task file:

```bash
codex run codex-tasks/create_entry_form.md --config codex.config.json
```

### 3. Codex Generates Output (Junior Dev)

Codex reads the task, follows patterns from `codex.config.json`, and generates:

**Output:** `codex-tasks/outputs/create_entry_form_result.md`
```typescript
// Complete implementation following patterns
import { useForm } from 'react-hook-form';
import { toast } from 'react-hot-toast';
// ... full component code
```

**Log:** `codex-tasks/logs/create_entry_form_log.md`
```markdown
## Task: create_entry_form
Status: ‚úÖ Complete
Files: 1
Build: ‚úÖ Pass
Validation: ‚úÖ All checks pass

Output: codex-tasks/outputs/create_entry_form_result.md
```

### 4. User Commits & Pushes

User reviews output, copies code to proper location, commits:

```bash
# Review output
cat codex-tasks/outputs/create_entry_form_result.md

# Copy to proper location
cp codex-tasks/outputs/create_entry_form_result.md src/components/EntryForm.tsx

# Test build
npm run build

# Commit
git add .
git commit -m "feat: Add entry form component

Generated by Codex from codex-tasks/create_entry_form.md

ü§ñ Claude Code + Codex"

git push
```

### 5. Claude Integrates (Senior Dev)

Claude picks up after push, verifies deployment, integrates into larger feature.

## What Codex Can Handle (Junior Dev Tasks)

‚úÖ **Allowed:**
- Boilerplate generation (components, routers, forms)
- CRUD operations (basic list/create/update/delete)
- Component scaffolding following existing patterns
- Migration file generation (structure only)
- Test file generation
- Form components with validation
- Simple UI components

‚ùå **Forbidden (Escalate to Claude):**
- Architecture decisions
- Complex state management
- API design
- Security-critical code
- Performance optimization
- System integration
- Database schema changes (create blocker)

## Patterns Available to Codex

Codex has access to these patterns from `codex.config.json`:

1. **glassmorphic_card** - Standard card component
2. **gradient_background** - Full-page gradient
3. **trpc_router** - tRPC router template
4. **form_component** - React Hook Form template
5. **toast_notification** - Success/error toasts

## Codex Blockers

If Codex encounters something it can't handle:

**Create:** `codex-tasks/blockers/BLOCKER_NAME.md`

```markdown
## Blocker: Unclear Schema Field

**Task:** create_entry_form
**Issue:** Task requires field 'participants' but schema shows 'entry_participants'

**Question:** Which field name should be used?

**Blocking:** Cannot proceed without schema clarification

**Escalate to:** Claude (senior dev)
```

Claude will resolve and update task specification.

## Quality Gates

Before Codex outputs code, it validates:

1. ‚úÖ `npm run build` succeeds
2. ‚úÖ Prisma field names match schema.prisma
3. ‚úÖ UI follows glassmorphic pattern
4. ‚úÖ Forms have validation and error handling
5. ‚úÖ Loading states present for async operations
6. ‚úÖ Toast notifications for user feedback

## Example Task Types

### Boilerplate: New tRPC Router

```markdown
## Task: Create Studio Router

Generate tRPC router for Studio operations:
- list: Get all studios
- byId: Get studio by ID
- create: Create new studio (name, email, phone, address)

Use pattern: trpc_router from config
Output: src/server/routers/studio.ts
```

### Component: Form

```markdown
## Task: Create Competition Form

Generate form component for creating competitions:
- Fields: name, start_date, end_date, location, categories (multiselect), space_limit
- Validation: All required except categories
- On submit: Call tRPC `competition.create`
- Toast on success/error

Output: src/components/CompetitionForm.tsx
```

### Migration: Schema Change

```markdown
## Task: Generate Migration for Judging Scores

Create migration file structure for:
- New table: JudgingScore
- Fields: id, entry_id (FK), judge_id (FK), technical_score, artistic_score, comments, created_at

Output: codex-tasks/migrations/add_judging_scores.prisma
Note: DO NOT apply - Claude will review and apply
```

## Token Savings

By delegating to Codex:

- **Claude tokens saved:** ~8k per boilerplate task
- **Parallel execution:** Codex runs while Claude works on architecture
- **Result:** 2-3x throughput on multi-component features

## Integration with CADENCE

When Claude is in CADENCE mode:

1. Claude identifies boilerplate tasks
2. Creates task specs in `codex-tasks/`
3. Tells user: "Run these in Codex while I continue"
4. Claude continues with complex tasks
5. User commits Codex outputs
6. Claude integrates and verifies in next iteration

Both agents work in parallel - maximum efficiency.
