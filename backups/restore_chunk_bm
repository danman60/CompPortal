   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = 'super_admin'::public.user_role)))));


--
-- Name: entry_size_categories Admins can manage size categories; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Admins can manage size categories" ON public.entry_size_categories USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = 'super_admin'::public.user_role))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = 'super_admin'::public.user_role)))));


--
-- Name: system_settings Admins can manage system settings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Admins can manage system settings" ON public.system_settings USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = 'super_admin'::public.user_role))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = 'super_admin'::public.user_role)))));


--
-- Name: invoices Admins can update invoices; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Admins can update invoices" ON public.invoices FOR UPDATE USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: activity_logs Authenticated users can create activity logs; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can create activity logs" ON public.activity_logs FOR INSERT TO authenticated WITH CHECK ((user_id = ( SELECT auth.uid() AS uid)));


--
-- Name: age_groups Authenticated users can view age groups; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view age groups" ON public.age_groups FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: award_types Authenticated users can view award types; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view award types" ON public.award_types FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: dance_categories Authenticated users can view categories; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view categories" ON public.dance_categories FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: classifications Authenticated users can view classifications; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view classifications" ON public.classifications FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: competition_settings Authenticated users can view competition settings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view competition settings" ON public.competition_settings FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: competitions Authenticated users can view competitions; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view competitions" ON public.competitions FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: elite_instructors Authenticated users can view elite instructors; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view elite instructors" ON public.elite_instructors FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: email_templates Authenticated users can view email templates; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view email templates" ON public.email_templates FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: judges Authenticated users can view judges; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view judges" ON public.judges FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: competition_locations Authenticated users can view locations; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view locations" ON public.competition_locations FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: competition_sessions Authenticated users can view sessions; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view sessions" ON public.competition_sessions FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: entry_size_categories Authenticated users can view size categories; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view size categories" ON public.entry_size_categories FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: system_settings Authenticated users can view system settings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view system settings" ON public.system_settings FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: title_rounds Authenticated users can view title rounds; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view title rounds" ON public.title_rounds FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: vip_events Authenticated users can view vip events; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view vip events" ON public.vip_events FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: classification_exception_requests Competition Directors can update classification requests; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Competition Directors can update classification requests" ON public.classification_exception_requests FOR UPDATE USING ((tenant_id IN ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: classification_exception_requests Competition Directors can view classification requests; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Competition Directors can view classification requests" ON public.classification_exception_requests FOR SELECT USING ((tenant_id IN ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: scoring_tiers Competition directors can manage scoring tiers; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Competition directors can manage scoring tiers" ON public.scoring_tiers USING (((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))) AND (EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))));


--
-- Name: awards Directors and admins can delete awards; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can delete awards" ON public.awards FOR DELETE USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: competition_settings Directors and admins can delete competition settings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can delete competition settings" ON public.competition_settings FOR DELETE USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: rankings Directors and admins can delete rankings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can delete rankings" ON public.rankings FOR DELETE USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: awards Directors and admins can insert awards; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can insert awards" ON public.awards FOR INSERT WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: competition_settings Directors and admins can insert competition settings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can insert competition settings" ON public.competition_settings FOR INSERT WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: rankings Directors and admins can insert rankings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can insert rankings" ON public.rankings FOR INSERT WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: competitions Directors and admins can manage competitions; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can manage competitions" ON public.competitions USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: elite_instructors Directors and admins can manage elite instructors; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can manage elite instructors" ON public.elite_instructors USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: email_templates Directors and admins can manage email templates; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can manage email templates" ON public.email_templates USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: judges Directors and admins can manage judges; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can manage judges" ON public.judges USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: competition_locations Directors and admins can manage locations; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can manage locations" ON public.competition_locations USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: competition_sessions Directors and admins can manage sessions; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can manage sessions" ON public.competition_sessions USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: title_rounds Directors and admins can manage title rounds; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can manage title rounds" ON public.title_rounds USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: vip_events Directors and admins can manage vip events; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can manage vip events" ON public.vip_events USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: awards Directors and admins can update awards; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can update awards" ON public.awards FOR UPDATE USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: competition_settings Directors and admins can update competition settings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can update competition settings" ON public.competition_settings FOR UPDATE USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: rankings Directors and admins can update rankings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can update rankings" ON public.rankings FOR UPDATE USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: awards Directors and admins can view all awards; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can view all awards" ON public.awards FOR SELECT USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: rankings Directors and admins can view all rankings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can view all rankings" ON public.rankings FOR SELECT USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: documents Document access control; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Document access control" ON public.documents USING (((studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.owner_id = auth.uid()))) OR (uploaded_by = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))));


--
-- Name: entry_participants Entry participant access; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Entry participant access" ON public.entry_participants USING (((EXISTS ( SELECT 1
   FROM public.competition_entries e
  WHERE ((e.id = entry_participants.entry_id) AND (e.studio_id IN ( SELECT studios.id
           FROM public.studios
          WHERE (studios.owner_id = auth.uid())))))) OR (EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))));


--
-- Name: awards Judges can view competition awards; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Judges can view competition awards" ON public.awards FOR SELECT USING ((competition_id IN ( SELECT judges.competition_id
   FROM public.judges
  WHERE (judges.user_id = ( SELECT auth.uid() AS uid)))));


--
-- Name: rankings Judges can view competition rankings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Judges can view competition rankings" ON public.rankings FOR SELECT USING ((competition_id IN ( SELECT judges.competition_id
   FROM public.judges
  WHERE (judges.user_id = ( SELECT auth.uid() AS uid)))));


--
-- Name: email_logs Service can insert email logs; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Service can insert email logs" ON public.email_logs FOR INSERT WITH CHECK (true);


--
-- Name: email_queue Service role full access to email_queue; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Service role full access to email_queue" ON public.email_queue TO service_role USING (true) WITH CHECK (true);


--
-- Name: classification_exception_requests Studio Directors can create classification requests; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Studio Directors can create classification requests" ON public.classification_exception_requests FOR INSERT WITH CHECK (((studio_id IN ( SELECT classification_exception_requests.studio_id
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = 'studio_director'::public.user_role)))) AND (tenant_id IN ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid())))));


--
-- Name: classification_exception_requests Studio Directors can delete pending requests; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Studio Directors can delete pending requests" ON public.classification_exception_requests FOR DELETE USING (((studio_id IN ( SELECT classification_exception_requests.studio_id
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = 'studio_director'::public.user_role)))) AND ((status)::text = 'pending'::text)));


--
-- Name: classification_exception_requests Studio Directors can view their classification requests; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Studio Directors can view their classification requests" ON public.classification_exception_requests FOR SELECT USING ((studio_id IN ( SELECT classification_exception_requests.studio_id
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = 'studio_director'::public.user_role)))));


--
-- Name: dancers Studio access to dancers; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Studio access to dancers" ON public.dancers USING ((studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.owner_id = auth.uid()))));


--
-- Name: competition_entries Studio access to entries; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Studio access to entries" ON public.competition_entries USING (((studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.owner_id = auth.uid()))) OR (EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))));


--
-- Name: reservations Studio access to reservations; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Studio access to reservations" ON public.reservations USING (((studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.owner_id = auth.uid()))) OR (EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))));


--
-- Name: studios Studio owners can view own studios; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Studio owners can view own studios" ON public.studios FOR SELECT USING (((owner_id = ( SELECT auth.uid() AS uid)) OR (EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))));


--
-- Name: awards Studios can view own awards; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Studios can view own awards" ON public.awards FOR SELECT USING ((entry_id IN ( SELECT e.id
   FROM public.competition_entries e
  WHERE (e.studio_id IN ( SELECT studios.id
           FROM public.studios
          WHERE (studios.owner_id = auth.uid()))))));


--
-- Name: rankings Studios can view own rankings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Studios can view own rankings" ON public.rankings FOR SELECT USING ((entry_id IN ( SELECT e.id
   FROM public.competition_entries e
  WHERE (e.studio_id IN ( SELECT studios.id
           FROM public.studios
          WHERE (studios.owner_id = auth.uid()))))));


--
-- Name: activity_logs Studios can view studio activities; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Studios can view studio activities" ON public.activity_logs FOR SELECT USING ((studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.owner_id = ( SELECT auth.uid() AS uid)))));


--
-- Name: studios Users can create own studio; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Users can create own studio" ON public.studios FOR INSERT TO authenticated WITH CHECK ((owner_id = auth.uid()));


--
-- Name: studios Users can delete own studio; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Users can delete own studio" ON public.studios FOR DELETE TO authenticated USING ((owner_id = auth.uid()));


--
-- Name: email_preferences Users can update own email preferences; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Users can update own email preferences" ON public.email_preferences USING ((auth.uid() = user_id));


--
-- Name: user_profiles Users can update own profile; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Users can update own profile" ON public.user_profiles FOR UPDATE USING ((id = ( SELECT auth.uid() AS uid)));


--
-- Name: studios Users can update own studio; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Users can update own studio" ON public.studios FOR UPDATE TO authenticated USING ((owner_id = auth.uid())) WITH CHECK ((owner_id = auth.uid()));


--
-- Name: activity_logs Users can view own activities; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Users can view own activities" ON public.activity_logs FOR SELECT USING ((user_id = ( SELECT auth.uid() AS uid)));


--
-- Name: email_preferences Users can view own email preferences; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Users can view own email preferences" ON public.email_preferences FOR SELECT USING ((auth.uid() = user_id));


--
-- Name: email_queue Users can view own emails; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Users can view own emails" ON public.email_queue FOR SELECT TO authenticated USING ((user_id = auth.uid()));


--
-- Name: user_profiles Users can view own profile; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Users can view own profile" ON public.user_profiles FOR SELECT USING ((id = ( SELECT auth.uid() AS uid)));


--
-- Name: scoring_tiers Users can view scoring tiers for their tenant; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Users can view scoring tiers for their tenant" ON public.scoring_tiers FOR SELECT USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: email_logs View email logs; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "View email logs" ON public.email_logs FOR SELECT USING (((studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.owner_id = auth.uid()))) OR (EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))));


--
-- Name: invoices View invoices; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "View invoices" ON public.invoices FOR SELECT USING (((studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.owner_id = auth.uid()))) OR (EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))));


--
-- Name: activity_logs; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.activity_logs ENABLE ROW LEVEL SECURITY;

--
-- Name: activity_logs activity_logs_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY activity_logs_service_role ON public.activity_logs TO service_role USING (true) WITH CHECK (true);


--
-- Name: activity_logs activity_logs_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY activity_logs_tenant_isolation ON public.activity_logs TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: age_groups; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.age_groups ENABLE ROW LEVEL SECURITY;

--
-- Name: award_types; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.award_types ENABLE ROW LEVEL SECURITY;

--
-- Name: award_types award_types_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY award_types_service_role ON public.award_types TO service_role USING (true) WITH CHECK (true);


--
-- Name: award_types award_types_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY award_types_tenant_isolation ON public.award_types TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: awards; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.awards ENABLE ROW LEVEL SECURITY;

--
-- Name: awards awards_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY awards_service_role ON public.awards TO service_role USING (true) WITH CHECK (true);


--
-- Name: awards awards_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY awards_tenant_isolation ON public.awards TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: capacity_ledger; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.capacity_ledger ENABLE ROW LEVEL SECURITY;

--
-- Name: capacity_ledger capacity_ledger_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY capacity_ledger_service_role ON public.capacity_ledger TO service_role USING (true) WITH CHECK (true);


--
-- Name: capacity_ledger capacity_ledger_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY capacity_ledger_tenant_isolation ON public.capacity_ledger TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: classification_exception_requests; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.classification_exception_requests ENABLE ROW LEVEL SECURITY;

--
-- Name: classifications; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.classifications ENABLE ROW LEVEL SECURITY;

--
-- Name: classifications classifications_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY classifications_service_role ON public.classifications TO service_role USING (true) WITH CHECK (true);


--
-- Name: classifications classifications_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY classifications_tenant_isolation ON public.classifications TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: competition_entries; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.competition_entries ENABLE ROW LEVEL SECURITY;

--
-- Name: competition_locations; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.competition_locations ENABLE ROW LEVEL SECURITY;

--
-- Name: competition_locations competition_locations_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY competition_locations_service_role ON public.competition_locations TO service_role USING (true) WITH CHECK (true);


--
-- Name: competition_locations competition_locations_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY competition_locations_tenant_isolation ON public.competition_locations TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: competition_sessions; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.competition_sessions ENABLE ROW LEVEL SECURITY;

--
-- Name: competition_sessions competition_sessions_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY competition_sessions_service_role ON public.competition_sessions TO service_role USING (true) WITH CHECK (true);


--
-- Name: competition_sessions competition_sessions_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY competition_sessions_tenant_isolation ON public.competition_sessions TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: competition_settings; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.competition_settings ENABLE ROW LEVEL SECURITY;

--
-- Name: competitions; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.competitions ENABLE ROW LEVEL SECURITY;

--
-- Name: competitions competitions_cd_insert; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY competitions_cd_insert ON public.competitions FOR INSERT TO authenticated WITH CHECK (((tenant_id = public.get_user_tenant_id()) AND (( SELECT user_profiles.role
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid())) = 'competition_director'::public.user_role)));


--
-- Name: competitions competitions_cd_update; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY competitions_cd_update ON public.competitions FOR UPDATE TO authenticated USING (((tenant_id = public.get_user_tenant_id()) AND (( SELECT user_profiles.role
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid())) = 'competition_director'::public.user_role)));


--
-- Name: competitions competitions_super_admin_all; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY competitions_super_admin_all ON public.competitions TO authenticated USING (public.is_super_admin());


--
-- Name: competitions competitions_user_select; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY competitions_user_select ON public.competitions FOR SELECT TO authenticated USING ((tenant_id = public.get_user_tenant_id()));


--
-- Name: dance_categories; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.dance_categories ENABLE ROW LEVEL SECURITY;

--
-- Name: dancers; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.dancers ENABLE ROW LEVEL SECURITY;

--
-- Name: dancers dancers_cd_select; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY dancers_cd_select ON public.dancers FOR SELECT TO authenticated USING (((tenant_id = public.get_user_tenant_id()) AND (( SELECT user_profiles.role
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid())) = 'competition_director'::public.user_role)));


--
-- Name: dancers dancers_sd_all; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY dancers_sd_all ON public.dancers TO authenticated USING (((tenant_id = public.get_user_tenant_id()) AND (studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.owner_id = auth.uid())))));


--
-- Name: dancers dancers_super_admin_all; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY dancers_super_admin_all ON public.dancers TO authenticated USING (public.is_super_admin());


--
-- Name: documents; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.documents ENABLE ROW LEVEL SECURITY;

--
-- Name: documents documents_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY documents_service_role ON public.documents TO service_role USING (true) WITH CHECK (true);


--
-- Name: documents documents_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY documents_tenant_isolation ON public.documents TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: elite_instructors; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.elite_instructors ENABLE ROW LEVEL SECURITY;

--
-- Name: email_logs; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.email_logs ENABLE ROW LEVEL SECURITY;

--
-- Name: email_logs email_logs_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY email_logs_service_role ON public.email_logs TO service_role USING (true) WITH CHECK (true);


--
-- Name: email_logs email_logs_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY email_logs_tenant_isolation ON public.email_logs TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: email_preferences; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.email_preferences ENABLE ROW LEVEL SECURITY;

--
-- Name: email_preferences email_preferences_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY email_preferences_service_role ON public.email_preferences TO service_role USING (true) WITH CHECK (true);


--
-- Name: email_preferences email_preferences_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY email_preferences_tenant_isolation ON public.email_preferences TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: email_queue; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.email_queue ENABLE ROW LEVEL SECURITY;

--
-- Name: email_templates; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.email_templates ENABLE ROW LEVEL SECURITY;

--
-- Name: email_templates email_templates_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY email_templates_service_role ON public.email_templates TO service_role USING (true) WITH CHECK (true);


--
-- Name: email_templates email_templates_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY email_templates_tenant_isolation ON public.email_templates TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: competition_entries entries_cd_select; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY entries_cd_select ON public.competition_entries FOR SELECT TO authenticated USING (((tenant_id = public.get_user_tenant_id()) AND (( SELECT user_profiles.role
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid())) = 'competition_director'::public.user_role)));


--
-- Name: competition_entries entries_sd_all; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY entries_sd_all ON public.competition_entries TO authenticated USING (((tenant_id = public.get_user_tenant_id()) AND (studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.owner_id = auth.uid())))));


--
-- Name: competition_entries entries_super_admin_all; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY entries_super_admin_all ON public.competition_entries TO authenticated USING (public.is_super_admin());


--
-- Name: entry_participants; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.entry_participants ENABLE ROW LEVEL SECURITY;

--
-- Name: entry_participants entry_participants_service_role; Type: POLICY; Schema: public; Owner: -
--
