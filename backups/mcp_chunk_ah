--
-- Name: buckets_analytics buckets_analytics_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
--

ALTER TABLE ONLY storage.buckets_analytics
    ADD CONSTRAINT buckets_analytics_pkey PRIMARY KEY (id);


--
-- Name: buckets buckets_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
--

ALTER TABLE ONLY storage.buckets
    ADD CONSTRAINT buckets_pkey PRIMARY KEY (id);


--
-- Name: migrations migrations_name_key; Type: CONSTRAINT; Schema: storage; Owner: -
--

ALTER TABLE ONLY storage.migrations
    ADD CONSTRAINT migrations_name_key UNIQUE (name);


--
-- Name: migrations migrations_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
--

ALTER TABLE ONLY storage.migrations
    ADD CONSTRAINT migrations_pkey PRIMARY KEY (id);


--
-- Name: objects objects_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
--

ALTER TABLE ONLY storage.objects
    ADD CONSTRAINT objects_pkey PRIMARY KEY (id);


--
-- Name: prefixes prefixes_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
--

ALTER TABLE ONLY storage.prefixes
    ADD CONSTRAINT prefixes_pkey PRIMARY KEY (bucket_id, level, name);


--
-- Name: s3_multipart_uploads_parts s3_multipart_uploads_parts_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
--

ALTER TABLE ONLY storage.s3_multipart_uploads_parts
    ADD CONSTRAINT s3_multipart_uploads_parts_pkey PRIMARY KEY (id);


--
-- Name: s3_multipart_uploads s3_multipart_uploads_pkey; Type: CONSTRAINT; Schema: storage; Owner: -
--

ALTER TABLE ONLY storage.s3_multipart_uploads
    ADD CONSTRAINT s3_multipart_uploads_pkey PRIMARY KEY (id);


--
-- Name: schema_migrations schema_migrations_idempotency_key_key; Type: CONSTRAINT; Schema: supabase_migrations; Owner: -
--

ALTER TABLE ONLY supabase_migrations.schema_migrations
    ADD CONSTRAINT schema_migrations_idempotency_key_key UNIQUE (idempotency_key);


--
-- Name: schema_migrations schema_migrations_pkey; Type: CONSTRAINT; Schema: supabase_migrations; Owner: -
--

ALTER TABLE ONLY supabase_migrations.schema_migrations
    ADD CONSTRAINT schema_migrations_pkey PRIMARY KEY (version);


--
-- Name: audit_logs_instance_id_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX audit_logs_instance_id_idx ON auth.audit_log_entries USING btree (instance_id);


--
-- Name: confirmation_token_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE UNIQUE INDEX confirmation_token_idx ON auth.users USING btree (confirmation_token) WHERE ((confirmation_token)::text !~ '^[0-9 ]*$'::text);


--
-- Name: email_change_token_current_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE UNIQUE INDEX email_change_token_current_idx ON auth.users USING btree (email_change_token_current) WHERE ((email_change_token_current)::text !~ '^[0-9 ]*$'::text);


--
-- Name: email_change_token_new_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE UNIQUE INDEX email_change_token_new_idx ON auth.users USING btree (email_change_token_new) WHERE ((email_change_token_new)::text !~ '^[0-9 ]*$'::text);


--
-- Name: factor_id_created_at_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX factor_id_created_at_idx ON auth.mfa_factors USING btree (user_id, created_at);


--
-- Name: flow_state_created_at_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX flow_state_created_at_idx ON auth.flow_state USING btree (created_at DESC);


--
-- Name: identities_email_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX identities_email_idx ON auth.identities USING btree (email text_pattern_ops);


--
-- Name: INDEX identities_email_idx; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON INDEX auth.identities_email_idx IS 'Auth: Ensures indexed queries on the email column';


--
-- Name: identities_user_id_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX identities_user_id_idx ON auth.identities USING btree (user_id);


--
-- Name: idx_auth_code; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX idx_auth_code ON auth.flow_state USING btree (auth_code);


--
-- Name: idx_user_id_auth_method; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX idx_user_id_auth_method ON auth.flow_state USING btree (user_id, authentication_method);


--
-- Name: mfa_challenge_created_at_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX mfa_challenge_created_at_idx ON auth.mfa_challenges USING btree (created_at DESC);


--
-- Name: mfa_factors_user_friendly_name_unique; Type: INDEX; Schema: auth; Owner: -
--

CREATE UNIQUE INDEX mfa_factors_user_friendly_name_unique ON auth.mfa_factors USING btree (friendly_name, user_id) WHERE (TRIM(BOTH FROM friendly_name) <> ''::text);


--
-- Name: mfa_factors_user_id_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX mfa_factors_user_id_idx ON auth.mfa_factors USING btree (user_id);


--
-- Name: oauth_auth_pending_exp_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX oauth_auth_pending_exp_idx ON auth.oauth_authorizations USING btree (expires_at) WHERE (status = 'pending'::auth.oauth_authorization_status);


--
-- Name: oauth_clients_deleted_at_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX oauth_clients_deleted_at_idx ON auth.oauth_clients USING btree (deleted_at);


--
-- Name: oauth_consents_active_client_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX oauth_consents_active_client_idx ON auth.oauth_consents USING btree (client_id) WHERE (revoked_at IS NULL);


--
-- Name: oauth_consents_active_user_client_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX oauth_consents_active_user_client_idx ON auth.oauth_consents USING btree (user_id, client_id) WHERE (revoked_at IS NULL);


--
-- Name: oauth_consents_user_order_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX oauth_consents_user_order_idx ON auth.oauth_consents USING btree (user_id, granted_at DESC);


--
-- Name: one_time_tokens_relates_to_hash_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX one_time_tokens_relates_to_hash_idx ON auth.one_time_tokens USING hash (relates_to);


--
-- Name: one_time_tokens_token_hash_hash_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX one_time_tokens_token_hash_hash_idx ON auth.one_time_tokens USING hash (token_hash);


--
-- Name: one_time_tokens_user_id_token_type_key; Type: INDEX; Schema: auth; Owner: -
--

CREATE UNIQUE INDEX one_time_tokens_user_id_token_type_key ON auth.one_time_tokens USING btree (user_id, token_type);


--
-- Name: reauthentication_token_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE UNIQUE INDEX reauthentication_token_idx ON auth.users USING btree (reauthentication_token) WHERE ((reauthentication_token)::text !~ '^[0-9 ]*$'::text);


--
-- Name: recovery_token_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE UNIQUE INDEX recovery_token_idx ON auth.users USING btree (recovery_token) WHERE ((recovery_token)::text !~ '^[0-9 ]*$'::text);


--
-- Name: refresh_tokens_instance_id_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX refresh_tokens_instance_id_idx ON auth.refresh_tokens USING btree (instance_id);


--
-- Name: refresh_tokens_instance_id_user_id_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX refresh_tokens_instance_id_user_id_idx ON auth.refresh_tokens USING btree (instance_id, user_id);


--
-- Name: refresh_tokens_parent_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX refresh_tokens_parent_idx ON auth.refresh_tokens USING btree (parent);


--
-- Name: refresh_tokens_session_id_revoked_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX refresh_tokens_session_id_revoked_idx ON auth.refresh_tokens USING btree (session_id, revoked);


--
-- Name: refresh_tokens_updated_at_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX refresh_tokens_updated_at_idx ON auth.refresh_tokens USING btree (updated_at DESC);


--
-- Name: saml_providers_sso_provider_id_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX saml_providers_sso_provider_id_idx ON auth.saml_providers USING btree (sso_provider_id);


--
-- Name: saml_relay_states_created_at_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX saml_relay_states_created_at_idx ON auth.saml_relay_states USING btree (created_at DESC);


--
-- Name: saml_relay_states_for_email_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX saml_relay_states_for_email_idx ON auth.saml_relay_states USING btree (for_email);


--
-- Name: saml_relay_states_sso_provider_id_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX saml_relay_states_sso_provider_id_idx ON auth.saml_relay_states USING btree (sso_provider_id);


--
-- Name: sessions_not_after_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX sessions_not_after_idx ON auth.sessions USING btree (not_after DESC);


--
-- Name: sessions_oauth_client_id_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX sessions_oauth_client_id_idx ON auth.sessions USING btree (oauth_client_id);


--
-- Name: sessions_user_id_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX sessions_user_id_idx ON auth.sessions USING btree (user_id);


--
-- Name: sso_domains_domain_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE UNIQUE INDEX sso_domains_domain_idx ON auth.sso_domains USING btree (lower(domain));


--
-- Name: sso_domains_sso_provider_id_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX sso_domains_sso_provider_id_idx ON auth.sso_domains USING btree (sso_provider_id);


--
-- Name: sso_providers_resource_id_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE UNIQUE INDEX sso_providers_resource_id_idx ON auth.sso_providers USING btree (lower(resource_id));


--
-- Name: sso_providers_resource_id_pattern_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX sso_providers_resource_id_pattern_idx ON auth.sso_providers USING btree (resource_id text_pattern_ops);


--
-- Name: unique_phone_factor_per_user; Type: INDEX; Schema: auth; Owner: -
--

CREATE UNIQUE INDEX unique_phone_factor_per_user ON auth.mfa_factors USING btree (user_id, phone);


--
-- Name: user_id_created_at_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX user_id_created_at_idx ON auth.sessions USING btree (user_id, created_at);


--
-- Name: users_email_partial_key; Type: INDEX; Schema: auth; Owner: -
--

CREATE UNIQUE INDEX users_email_partial_key ON auth.users USING btree (email) WHERE (is_sso_user = false);


--
-- Name: INDEX users_email_partial_key; Type: COMMENT; Schema: auth; Owner: -
--

COMMENT ON INDEX auth.users_email_partial_key IS 'Auth: A partial unique index that applies only when is_sso_user is false';


--
-- Name: users_instance_id_email_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX users_instance_id_email_idx ON auth.users USING btree (instance_id, lower((email)::text));


--
-- Name: users_instance_id_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX users_instance_id_idx ON auth.users USING btree (instance_id);


--
-- Name: users_is_anonymous_idx; Type: INDEX; Schema: auth; Owner: -
--

CREATE INDEX users_is_anonymous_idx ON auth.users USING btree (is_anonymous);


--
-- Name: idx_2fa_audit_action; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_2fa_audit_action ON public.two_factor_audit_log USING btree (action);


--
-- Name: idx_2fa_audit_timestamp; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_2fa_audit_timestamp ON public.two_factor_audit_log USING btree ("timestamp" DESC);


--
-- Name: idx_2fa_audit_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_2fa_audit_user ON public.two_factor_audit_log USING btree (user_id);


--
-- Name: idx_activity_logs_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_activity_logs_created_at ON public.activity_logs USING btree (created_at DESC);


--
-- Name: idx_activity_logs_entity; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_activity_logs_entity ON public.activity_logs USING btree (entity_type, entity_id);


--
-- Name: idx_activity_logs_studio_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_activity_logs_studio_id ON public.activity_logs USING btree (studio_id);


--
-- Name: idx_activity_logs_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_activity_logs_tenant ON public.activity_logs USING btree (tenant_id);


--
-- Name: idx_activity_logs_tenant_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_activity_logs_tenant_user ON public.activity_logs USING btree (tenant_id, user_id);


--
-- Name: idx_activity_logs_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_activity_logs_user_id ON public.activity_logs USING btree (user_id);


--
-- Name: idx_age_groups_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_age_groups_tenant ON public.age_groups USING btree (tenant_id);


--
-- Name: idx_award_types_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_award_types_tenant ON public.award_types USING btree (tenant_id);


--
-- Name: idx_awards_award_type_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_awards_award_type_id ON public.awards USING btree (award_type_id);


--
-- Name: idx_awards_competition_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_awards_competition_id ON public.awards USING btree (competition_id);


--
-- Name: idx_awards_entry_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_awards_entry_id ON public.awards USING btree (entry_id);


--
-- Name: idx_awards_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_awards_tenant ON public.awards USING btree (tenant_id);


--
-- Name: idx_awards_tenant_entry; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_awards_tenant_entry ON public.awards USING btree (tenant_id, entry_id);


--
-- Name: idx_capacity_ledger_competition; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_capacity_ledger_competition ON public.capacity_ledger USING btree (competition_id, created_at DESC);


--
-- Name: idx_capacity_ledger_reservation; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_capacity_ledger_reservation ON public.capacity_ledger USING btree (reservation_id);


--
-- Name: idx_capacity_ledger_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_capacity_ledger_tenant ON public.capacity_ledger USING btree (tenant_id);


--
-- Name: idx_capacity_ledger_tenant_competition; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_capacity_ledger_tenant_competition ON public.capacity_ledger USING btree (tenant_id, competition_id);


--
-- Name: idx_classification_requests_competition; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_classification_requests_competition ON public.classification_exception_requests USING btree (competition_id);


--
-- Name: idx_classification_requests_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_classification_requests_created_at ON public.classification_exception_requests USING btree (created_at);


--
-- Name: idx_classification_requests_entry; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_classification_requests_entry ON public.classification_exception_requests USING btree (entry_id);


--
-- Name: idx_classification_requests_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_classification_requests_status ON public.classification_exception_requests USING btree (status);


--
-- Name: idx_classification_requests_studio; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_classification_requests_studio ON public.classification_exception_requests USING btree (studio_id);


--
-- Name: idx_classification_requests_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_classification_requests_tenant ON public.classification_exception_requests USING btree (tenant_id);


--
-- Name: idx_classifications_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_classifications_tenant ON public.classifications USING btree (tenant_id);


--
-- Name: idx_competition_entries_age_group_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competition_entries_age_group_id ON public.competition_entries USING btree (age_group_id);


--
-- Name: idx_competition_entries_category_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competition_entries_category_id ON public.competition_entries USING btree (category_id);


--
-- Name: idx_competition_entries_classification_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competition_entries_classification_id ON public.competition_entries USING btree (classification_id);


--
-- Name: idx_competition_entries_entry_size_category_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competition_entries_entry_size_category_id ON public.competition_entries USING btree (entry_size_category_id);


--
-- Name: idx_competition_entries_next_entry_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competition_entries_next_entry_id ON public.competition_entries USING btree (next_entry_id);


--
-- Name: idx_competition_entries_previous_entry_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competition_entries_previous_entry_id ON public.competition_entries USING btree (previous_entry_id);


--
-- Name: idx_competition_locations_competition_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competition_locations_competition_id ON public.competition_locations USING btree (competition_id);


--
-- Name: idx_competition_locations_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competition_locations_tenant ON public.competition_locations USING btree (tenant_id);


--
-- Name: idx_competition_locations_tenant_competition; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competition_locations_tenant_competition ON public.competition_locations USING btree (tenant_id, competition_id);


--
-- Name: idx_competition_sessions_competition_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competition_sessions_competition_id ON public.competition_sessions USING btree (competition_id);


--
-- Name: idx_competition_sessions_head_judge; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competition_sessions_head_judge ON public.competition_sessions USING btree (head_judge);


--
-- Name: idx_competition_sessions_location_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competition_sessions_location_id ON public.competition_sessions USING btree (location_id);


--
-- Name: idx_competition_sessions_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competition_sessions_tenant ON public.competition_sessions USING btree (tenant_id);


--
-- Name: idx_competition_sessions_tenant_competition; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competition_sessions_tenant_competition ON public.competition_sessions USING btree (tenant_id, competition_id);


--
-- Name: idx_competition_settings_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competition_settings_active ON public.competition_settings USING btree (is_active);


--
-- Name: idx_competition_settings_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competition_settings_category ON public.competition_settings USING btree (setting_category);


--
-- Name: idx_competition_settings_display_order; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competition_settings_display_order ON public.competition_settings USING btree (display_order);


--
-- Name: idx_competitions_age_settings; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competitions_age_settings ON public.competitions USING gin (age_division_settings);


--
-- Name: idx_competitions_dates; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competitions_dates ON public.competitions USING btree (competition_start_date, competition_end_date);


--
-- Name: idx_competitions_schedule_lock; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competitions_schedule_lock ON public.competitions USING btree (schedule_locked);


--
-- Name: idx_competitions_scoring_settings; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competitions_scoring_settings ON public.competitions USING gin (scoring_system_settings);


--
-- Name: idx_competitions_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competitions_status ON public.competitions USING btree (status);


--
-- Name: idx_competitions_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competitions_tenant ON public.competitions USING btree (tenant_id);


--
-- Name: idx_competitions_year; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_competitions_year ON public.competitions USING btree (year);


--
-- Name: idx_dance_categories_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dance_categories_tenant ON public.dance_categories USING btree (tenant_id);


--
-- Name: idx_dancers_age; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dancers_age ON public.dancers USING btree (date_of_birth);


--
-- Name: idx_dancers_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dancers_name ON public.dancers USING btree (first_name, last_name);


--
-- Name: idx_dancers_studio; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dancers_studio ON public.dancers USING btree (studio_id);


--
-- Name: idx_dancers_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_dancers_tenant ON public.dancers USING btree (tenant_id);


--
-- Name: idx_documents_competition; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_documents_competition ON public.documents USING btree (competition_id);


--
-- Name: idx_documents_entry_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_documents_entry_id ON public.documents USING btree (entry_id);


--
-- Name: idx_documents_studio; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_documents_studio ON public.documents USING btree (studio_id);


--
-- Name: idx_documents_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_documents_tenant ON public.documents USING btree (tenant_id);


--
-- Name: idx_documents_tenant_competition; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_documents_tenant_competition ON public.documents USING btree (tenant_id, competition_id);


--
-- Name: idx_documents_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_documents_type ON public.documents USING btree (document_type);


--
-- Name: idx_documents_uploaded_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_documents_uploaded_by ON public.documents USING btree (uploaded_by);


--
-- Name: idx_elite_instructors_competition_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_elite_instructors_competition_id ON public.elite_instructors USING btree (competition_id);


--
-- Name: idx_email_logs_competition_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_logs_competition_id ON public.email_logs USING btree (competition_id);


--
-- Name: idx_email_logs_sent_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_logs_sent_at ON public.email_logs USING btree (sent_at);


--
-- Name: idx_email_logs_studio_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_logs_studio_id ON public.email_logs USING btree (studio_id);


--
-- Name: idx_email_logs_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_logs_tenant ON public.email_logs USING btree (tenant_id);


--
-- Name: idx_email_logs_tenant_competition; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_logs_tenant_competition ON public.email_logs USING btree (tenant_id, competition_id);


--
-- Name: idx_email_preferences_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_preferences_tenant ON public.email_preferences USING btree (tenant_id);


--
-- Name: idx_email_preferences_tenant_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_preferences_tenant_user ON public.email_preferences USING btree (tenant_id, user_id);


--
-- Name: idx_email_preferences_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_preferences_user_id ON public.email_preferences USING btree (user_id);


--
-- Name: idx_email_queue_status_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_queue_status_created ON public.email_queue USING btree (status, created_at) WHERE (status = 'pending'::text);


--
-- Name: idx_email_queue_tenant_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_queue_tenant_id ON public.email_queue USING btree (tenant_id);


--
-- Name: idx_email_queue_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_queue_user_id ON public.email_queue USING btree (user_id);


--
-- Name: idx_email_templates_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_templates_tenant ON public.email_templates USING btree (tenant_id);


--
-- Name: idx_email_templates_tenant_key; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_email_templates_tenant_key ON public.email_templates USING btree (tenant_id, template_key);


--
-- Name: idx_entries_award_level; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entries_award_level ON public.competition_entries USING btree (award_level);


--
-- Name: idx_entries_calculated_score; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entries_calculated_score ON public.competition_entries USING btree (calculated_score DESC);


--
-- Name: idx_entries_competition; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entries_competition ON public.competition_entries USING btree (competition_id);


--
-- Name: idx_entries_performance_time; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entries_performance_time ON public.competition_entries USING btree (performance_date, performance_time);


--
-- Name: idx_entries_placement; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entries_placement ON public.competition_entries USING btree (category_placement);


--
-- Name: idx_entries_reservation; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entries_reservation ON public.competition_entries USING btree (reservation_id) WHERE (reservation_id IS NOT NULL);


--
-- Name: INDEX idx_entries_reservation; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON INDEX public.idx_entries_reservation IS 'Optimizes space limit validation queries';


--
-- Name: idx_entries_reservation_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entries_reservation_status ON public.competition_entries USING btree (reservation_id, status) WHERE (reservation_id IS NOT NULL);


--
-- Name: INDEX idx_entries_reservation_status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON INDEX public.idx_entries_reservation_status IS 'Optimizes reservation capacity checks excluding cancelled entries';


--
-- Name: idx_entries_sequence; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entries_sequence ON public.competition_entries USING btree (sequence_number);


--
-- Name: idx_entries_session; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entries_session ON public.competition_entries USING btree (session_id);


--
-- Name: idx_entries_studio; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entries_studio ON public.competition_entries USING btree (studio_id);


--
-- Name: idx_entries_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entries_tenant ON public.competition_entries USING btree (tenant_id);


--
-- Name: idx_entry_number_per_comp; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_entry_number_per_comp ON public.competition_entries USING btree (competition_id, entry_number, COALESCE(entry_suffix, ''::character varying)) WHERE (entry_number IS NOT NULL);


--
-- Name: idx_entry_participants_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entry_participants_tenant ON public.entry_participants USING btree (tenant_id);


--
-- Name: idx_entry_participants_tenant_entry; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entry_participants_tenant_entry ON public.entry_participants USING btree (tenant_id, entry_id);


--
-- Name: idx_entry_size_categories_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_entry_size_categories_tenant ON public.entry_size_categories USING btree (tenant_id);


--
-- Name: idx_import_sessions_completed; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_import_sessions_completed ON public.routine_import_sessions USING btree (completed);


--
-- Name: idx_import_sessions_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_import_sessions_created_at ON public.routine_import_sessions USING btree (created_at);


--
-- Name: idx_import_sessions_studio; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_import_sessions_studio ON public.routine_import_sessions USING btree (studio_id);


--
-- Name: idx_invoices_competition; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoices_competition ON public.invoices USING btree (competition_id);


--
-- Name: idx_invoices_paid_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoices_paid_at ON public.invoices USING btree (paid_at);


--
-- Name: idx_invoices_reservation; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoices_reservation ON public.invoices USING btree (reservation_id);


--
-- Name: idx_invoices_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoices_status ON public.invoices USING btree (status);


--
-- Name: idx_invoices_stripe_customer; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoices_stripe_customer ON public.invoices USING btree (stripe_customer_id);


--
-- Name: idx_invoices_stripe_payment_intent; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoices_stripe_payment_intent ON public.invoices USING btree (stripe_payment_intent_id);


--
-- Name: idx_invoices_studio; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoices_studio ON public.invoices USING btree (studio_id);


--
-- Name: idx_invoices_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_invoices_tenant ON public.invoices USING btree (tenant_id);


--
-- Name: idx_judges_competition_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_judges_competition_id ON public.judges USING btree (competition_id);


--
-- Name: idx_judges_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_judges_tenant ON public.judges USING btree (tenant_id);


--
-- Name: idx_judges_tenant_competition; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_judges_tenant_competition ON public.judges USING btree (tenant_id, competition_id);


--
-- Name: idx_judges_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_judges_user_id ON public.judges USING btree (user_id);


--
-- Name: idx_participants_dancer; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_participants_dancer ON public.entry_participants USING btree (dancer_id);


--
-- Name: idx_participants_entry; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_participants_entry ON public.entry_participants USING btree (entry_id);


--
-- Name: idx_rankings_age_group_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rankings_age_group_id ON public.rankings USING btree (age_group_id);


--
-- Name: idx_rankings_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rankings_category ON public.rankings USING btree (category_id, age_group_id, classification_id);


--
-- Name: idx_rankings_classification_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rankings_classification_id ON public.rankings USING btree (classification_id);


--
-- Name: idx_rankings_competition; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rankings_competition ON public.rankings USING btree (competition_id);


--
-- Name: idx_rankings_entry_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rankings_entry_id ON public.rankings USING btree (entry_id);


--
-- Name: idx_rankings_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rankings_tenant ON public.rankings USING btree (tenant_id);


--
-- Name: idx_rankings_tenant_entry; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_rankings_tenant_entry ON public.rankings USING btree (tenant_id, entry_id);


--
-- Name: idx_reservations_approved_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_reservations_approved_by ON public.reservations USING btree (approved_by);


--
-- Name: idx_reservations_competition; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_reservations_competition ON public.reservations USING btree (competition_id);


--
-- Name: idx_reservations_location_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_reservations_location_id ON public.reservations USING btree (location_id);


--
-- Name: idx_reservations_payment_confirmed_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_reservations_payment_confirmed_by ON public.reservations USING btree (payment_confirmed_by);


--
-- Name: idx_reservations_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_reservations_status ON public.reservations USING btree (status);


--
-- Name: idx_reservations_studio; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_reservations_studio ON public.reservations USING btree (studio_id);


--
-- Name: idx_reservations_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_reservations_tenant ON public.reservations USING btree (tenant_id);


--
-- Name: idx_scores_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_scores_created ON public.scores USING btree (created_at);


--
-- Name: idx_scores_entry; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_scores_entry ON public.scores USING btree (entry_id);


--
-- Name: idx_scores_judge; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_scores_judge ON public.scores USING btree (judge_id);


--
-- Name: idx_scores_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_scores_tenant ON public.scores USING btree (tenant_id);


--
-- Name: idx_scores_tenant_entry; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_scores_tenant_entry ON public.scores USING btree (tenant_id, entry_id);


--
-- Name: idx_studios_code; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_studios_code ON public.studios USING btree (code);


--
-- Name: idx_studios_internal_notes; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_studios_internal_notes ON public.studios USING gin (to_tsvector('english'::regconfig, internal_notes));


--
-- Name: idx_studios_owner; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_studios_owner ON public.studios USING btree (owner_id);


--
-- Name: idx_studios_public_code; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_studios_public_code ON public.studios USING btree (public_code);


--
-- Name: idx_studios_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_studios_status ON public.studios USING btree (status);


--
-- Name: idx_studios_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_studios_tenant ON public.studios USING btree (tenant_id);


--
-- Name: idx_studios_verified_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_studios_verified_by ON public.studios USING btree (verified_by);


--
-- Name: idx_summaries_reservation; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_summaries_reservation ON public.summaries USING btree (reservation_id);


--
-- Name: idx_summaries_submitted_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_summaries_submitted_at ON public.summaries USING btree (submitted_at);


--
-- Name: idx_summaries_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_summaries_tenant ON public.summaries USING btree (tenant_id);


--
-- Name: idx_summaries_tenant_reservation; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_summaries_tenant_reservation ON public.summaries USING btree (tenant_id, reservation_id);


--
-- Name: idx_summary_entries_entry; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_summary_entries_entry ON public.summary_entries USING btree (entry_id);


--
-- Name: idx_summary_entries_summary; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_summary_entries_summary ON public.summary_entries USING btree (summary_id);


--
-- Name: idx_summary_entries_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_summary_entries_tenant ON public.summary_entries USING btree (tenant_id);


--
-- Name: idx_summary_entries_tenant_entry; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_summary_entries_tenant_entry ON public.summary_entries USING btree (tenant_id, entry_id);


--
-- Name: idx_tenants_age_settings; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_tenants_age_settings ON public.tenants USING gin (age_division_settings);


--
-- Name: idx_tenants_entry_size_settings; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_tenants_entry_size_settings ON public.tenants USING gin (entry_size_settings);


--
-- Name: idx_title_rounds_competition_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_title_rounds_competition_id ON public.title_rounds USING btree (competition_id);


--
-- Name: idx_title_rounds_session_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_title_rounds_session_id ON public.title_rounds USING btree (session_id);


--
-- Name: idx_title_rounds_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_title_rounds_tenant ON public.title_rounds USING btree (tenant_id);


--
-- Name: idx_title_rounds_tenant_competition; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_title_rounds_tenant_competition ON public.title_rounds USING btree (tenant_id, competition_id);


--
-- Name: idx_user_profiles_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_profiles_tenant ON public.user_profiles USING btree (tenant_id);


--
-- Name: idx_vip_events_competition_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vip_events_competition_id ON public.vip_events USING btree (competition_id);


--
-- Name: idx_vip_events_tenant; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vip_events_tenant ON public.vip_events USING btree (tenant_id);


--
-- Name: idx_vip_events_tenant_competition; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_vip_events_tenant_competition ON public.vip_events USING btree (tenant_id, competition_id);


--
-- Name: tenants_slug_key; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX tenants_slug_key ON public.tenants USING btree (slug);


--
-- Name: tenants_subdomain_key; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX tenants_subdomain_key ON public.tenants USING btree (subdomain);


--
-- Name: ix_realtime_subscription_entity; Type: INDEX; Schema: realtime; Owner: -
--

CREATE INDEX ix_realtime_subscription_entity ON realtime.subscription USING btree (entity);


--
-- Name: messages_inserted_at_topic_index; Type: INDEX; Schema: realtime; Owner: -
--

CREATE INDEX messages_inserted_at_topic_index ON ONLY realtime.messages USING btree (inserted_at DESC, topic) WHERE ((extension = 'broadcast'::text) AND (private IS TRUE));


--
-- Name: messages_2025_10_09_inserted_at_topic_idx; Type: INDEX; Schema: realtime; Owner: -
--

CREATE INDEX messages_2025_10_09_inserted_at_topic_idx ON realtime.messages_2025_10_09 USING btree (inserted_at DESC, topic) WHERE ((extension = 'broadcast'::text) AND (private IS TRUE));


--
-- Name: messages_2025_10_10_inserted_at_topic_idx; Type: INDEX; Schema: realtime; Owner: -
--

CREATE INDEX messages_2025_10_10_inserted_at_topic_idx ON realtime.messages_2025_10_10 USING btree (inserted_at DESC, topic) WHERE ((extension = 'broadcast'::text) AND (private IS TRUE));


--
-- Name: messages_2025_10_11_inserted_at_topic_idx; Type: INDEX; Schema: realtime; Owner: -
--

CREATE INDEX messages_2025_10_11_inserted_at_topic_idx ON realtime.messages_2025_10_11 USING btree (inserted_at DESC, topic) WHERE ((extension = 'broadcast'::text) AND (private IS TRUE));


--
-- Name: messages_2025_10_12_inserted_at_topic_idx; Type: INDEX; Schema: realtime; Owner: -
--

CREATE INDEX messages_2025_10_12_inserted_at_topic_idx ON realtime.messages_2025_10_12 USING btree (inserted_at DESC, topic) WHERE ((extension = 'broadcast'::text) AND (private IS TRUE));


--
-- Name: messages_2025_10_13_inserted_at_topic_idx; Type: INDEX; Schema: realtime; Owner: -
--

CREATE INDEX messages_2025_10_13_inserted_at_topic_idx ON realtime.messages_2025_10_13 USING btree (inserted_at DESC, topic) WHERE ((extension = 'broadcast'::text) AND (private IS TRUE));


--
-- Name: subscription_subscription_id_entity_filters_key; Type: INDEX; Schema: realtime; Owner: -
--

CREATE UNIQUE INDEX subscription_subscription_id_entity_filters_key ON realtime.subscription USING btree (subscription_id, entity, filters);


--
-- Name: bname; Type: INDEX; Schema: storage; Owner: -
--

CREATE UNIQUE INDEX bname ON storage.buckets USING btree (name);


--
-- Name: bucketid_objname; Type: INDEX; Schema: storage; Owner: -
--

CREATE UNIQUE INDEX bucketid_objname ON storage.objects USING btree (bucket_id, name);


--
-- Name: idx_multipart_uploads_list; Type: INDEX; Schema: storage; Owner: -
--

CREATE INDEX idx_multipart_uploads_list ON storage.s3_multipart_uploads USING btree (bucket_id, key, created_at);


--
-- Name: idx_name_bucket_level_unique; Type: INDEX; Schema: storage; Owner: -
--

CREATE UNIQUE INDEX idx_name_bucket_level_unique ON storage.objects USING btree (name COLLATE "C", bucket_id, level);


--
-- Name: idx_objects_bucket_id_name; Type: INDEX; Schema: storage; Owner: -
--

CREATE INDEX idx_objects_bucket_id_name ON storage.objects USING btree (bucket_id, name COLLATE "C");


--
-- Name: idx_objects_lower_name; Type: INDEX; Schema: storage; Owner: -
--

CREATE INDEX idx_objects_lower_name ON storage.objects USING btree ((path_tokens[level]), lower(name) text_pattern_ops, bucket_id, level);


--
-- Name: idx_prefixes_lower_name; Type: INDEX; Schema: storage; Owner: -
--

CREATE INDEX idx_prefixes_lower_name ON storage.prefixes USING btree (bucket_id, level, ((string_to_array(name, '/'::text))[level]), lower(name) text_pattern_ops);


--
-- Name: name_prefix_search; Type: INDEX; Schema: storage; Owner: -
--

CREATE INDEX name_prefix_search ON storage.objects USING btree (name text_pattern_ops);


--
-- Name: objects_bucket_id_level_idx; Type: INDEX; Schema: storage; Owner: -
--

CREATE UNIQUE INDEX objects_bucket_id_level_idx ON storage.objects USING btree (bucket_id, level, name COLLATE "C");


--
-- Name: messages_2025_10_09_inserted_at_topic_idx; Type: INDEX ATTACH; Schema: realtime; Owner: -
--

ALTER INDEX realtime.messages_inserted_at_topic_index ATTACH PARTITION realtime.messages_2025_10_09_inserted_at_topic_idx;


--
-- Name: messages_2025_10_09_pkey; Type: INDEX ATTACH; Schema: realtime; Owner: -
--

ALTER INDEX realtime.messages_pkey ATTACH PARTITION realtime.messages_2025_10_09_pkey;


--
-- Name: messages_2025_10_10_inserted_at_topic_idx; Type: INDEX ATTACH; Schema: realtime; Owner: -
--

ALTER INDEX realtime.messages_inserted_at_topic_index ATTACH PARTITION realtime.messages_2025_10_10_inserted_at_topic_idx;


--
-- Name: messages_2025_10_10_pkey; Type: INDEX ATTACH; Schema: realtime; Owner: -
--

ALTER INDEX realtime.messages_pkey ATTACH PARTITION realtime.messages_2025_10_10_pkey;


--
-- Name: messages_2025_10_11_inserted_at_topic_idx; Type: INDEX ATTACH; Schema: realtime; Owner: -
--

ALTER INDEX realtime.messages_inserted_at_topic_index ATTACH PARTITION realtime.messages_2025_10_11_inserted_at_topic_idx;


--
-- Name: messages_2025_10_11_pkey; Type: INDEX ATTACH; Schema: realtime; Owner: -
--

ALTER INDEX realtime.messages_pkey ATTACH PARTITION realtime.messages_2025_10_11_pkey;


--
-- Name: messages_2025_10_12_inserted_at_topic_idx; Type: INDEX ATTACH; Schema: realtime; Owner: -
--

ALTER INDEX realtime.messages_inserted_at_topic_index ATTACH PARTITION realtime.messages_2025_10_12_inserted_at_topic_idx;


--
-- Name: messages_2025_10_12_pkey; Type: INDEX ATTACH; Schema: realtime; Owner: -
--

ALTER INDEX realtime.messages_pkey ATTACH PARTITION realtime.messages_2025_10_12_pkey;


--
-- Name: messages_2025_10_13_inserted_at_topic_idx; Type: INDEX ATTACH; Schema: realtime; Owner: -
--

ALTER INDEX realtime.messages_inserted_at_topic_index ATTACH PARTITION realtime.messages_2025_10_13_inserted_at_topic_idx;


--
-- Name: messages_2025_10_13_pkey; Type: INDEX ATTACH; Schema: realtime; Owner: -
--

ALTER INDEX realtime.messages_pkey ATTACH PARTITION realtime.messages_2025_10_13_pkey;


--
-- Name: users on_auth_user_created; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER on_auth_user_created AFTER INSERT ON auth.users FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();


--
-- Name: users trigger_queue_email_change; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER trigger_queue_email_change AFTER UPDATE ON auth.users FOR EACH ROW EXECUTE FUNCTION public.queue_email_change_confirmation();


--
-- Name: users trigger_queue_password_recovery; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER trigger_queue_password_recovery AFTER UPDATE ON auth.users FOR EACH ROW EXECUTE FUNCTION public.queue_password_recovery_email();


--
-- Name: users trigger_queue_signup_confirmation; Type: TRIGGER; Schema: auth; Owner: -
--

CREATE TRIGGER trigger_queue_signup_confirmation AFTER INSERT ON auth.users FOR EACH ROW WHEN ((new.confirmation_token IS NOT NULL)) EXECUTE FUNCTION public.queue_signup_confirmation_email();


--
-- Name: scores trigger_scores_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER trigger_scores_updated_at BEFORE UPDATE ON public.scores FOR EACH ROW EXECUTE FUNCTION public.update_scores_updated_at();


--
-- Name: competition_entries update_competition_entries_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_competition_entries_updated_at BEFORE UPDATE ON public.competition_entries FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: competition_settings update_competition_settings_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_competition_settings_updated_at BEFORE UPDATE ON public.competition_settings FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: dancers update_dancers_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_dancers_updated_at BEFORE UPDATE ON public.dancers FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: documents update_documents_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_documents_updated_at BEFORE UPDATE ON public.documents FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: reservations update_reservations_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_reservations_updated_at BEFORE UPDATE ON public.reservations FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: studios update_studios_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_studios_updated_at BEFORE UPDATE ON public.studios FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: user_profiles update_user_profiles_updated_at; Type: TRIGGER; Schema: public; Owner: -
--

CREATE TRIGGER update_user_profiles_updated_at BEFORE UPDATE ON public.user_profiles FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();


--
-- Name: subscription tr_check_filters; Type: TRIGGER; Schema: realtime; Owner: -
--

CREATE TRIGGER tr_check_filters BEFORE INSERT OR UPDATE ON realtime.subscription FOR EACH ROW EXECUTE FUNCTION realtime.subscription_check_filters();


--
-- Name: buckets enforce_bucket_name_length_trigger; Type: TRIGGER; Schema: storage; Owner: -
--

CREATE TRIGGER enforce_bucket_name_length_trigger BEFORE INSERT OR UPDATE OF name ON storage.buckets FOR EACH ROW EXECUTE FUNCTION storage.enforce_bucket_name_length();


--
-- Name: objects objects_delete_delete_prefix; Type: TRIGGER; Schema: storage; Owner: -
--

CREATE TRIGGER objects_delete_delete_prefix AFTER DELETE ON storage.objects FOR EACH ROW EXECUTE FUNCTION storage.delete_prefix_hierarchy_trigger();


--
-- Name: objects objects_insert_create_prefix; Type: TRIGGER; Schema: storage; Owner: -
--

CREATE TRIGGER objects_insert_create_prefix BEFORE INSERT ON storage.objects FOR EACH ROW EXECUTE FUNCTION storage.objects_insert_prefix_trigger();


--
-- Name: objects objects_update_create_prefix; Type: TRIGGER; Schema: storage; Owner: -
--

CREATE TRIGGER objects_update_create_prefix BEFORE UPDATE ON storage.objects FOR EACH ROW WHEN (((new.name <> old.name) OR (new.bucket_id <> old.bucket_id))) EXECUTE FUNCTION storage.objects_update_prefix_trigger();


--
-- Name: prefixes prefixes_create_hierarchy; Type: TRIGGER; Schema: storage; Owner: -
--

CREATE TRIGGER prefixes_create_hierarchy BEFORE INSERT ON storage.prefixes FOR EACH ROW WHEN ((pg_trigger_depth() < 1)) EXECUTE FUNCTION storage.prefixes_insert_trigger();


--
-- Name: prefixes prefixes_delete_hierarchy; Type: TRIGGER; Schema: storage; Owner: -
--

CREATE TRIGGER prefixes_delete_hierarchy AFTER DELETE ON storage.prefixes FOR EACH ROW EXECUTE FUNCTION storage.delete_prefix_hierarchy_trigger();


--
-- Name: objects update_objects_updated_at; Type: TRIGGER; Schema: storage; Owner: -
--

CREATE TRIGGER update_objects_updated_at BEFORE UPDATE ON storage.objects FOR EACH ROW EXECUTE FUNCTION storage.update_updated_at_column();


--
-- Name: identities identities_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.identities
    ADD CONSTRAINT identities_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: mfa_amr_claims mfa_amr_claims_session_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.mfa_amr_claims
    ADD CONSTRAINT mfa_amr_claims_session_id_fkey FOREIGN KEY (session_id) REFERENCES auth.sessions(id) ON DELETE CASCADE;


--
-- Name: mfa_challenges mfa_challenges_auth_factor_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.mfa_challenges
    ADD CONSTRAINT mfa_challenges_auth_factor_id_fkey FOREIGN KEY (factor_id) REFERENCES auth.mfa_factors(id) ON DELETE CASCADE;


--
-- Name: mfa_factors mfa_factors_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.mfa_factors
    ADD CONSTRAINT mfa_factors_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: oauth_authorizations oauth_authorizations_client_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.oauth_authorizations
    ADD CONSTRAINT oauth_authorizations_client_id_fkey FOREIGN KEY (client_id) REFERENCES auth.oauth_clients(id) ON DELETE CASCADE;


--
-- Name: oauth_authorizations oauth_authorizations_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.oauth_authorizations
    ADD CONSTRAINT oauth_authorizations_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: oauth_consents oauth_consents_client_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.oauth_consents
    ADD CONSTRAINT oauth_consents_client_id_fkey FOREIGN KEY (client_id) REFERENCES auth.oauth_clients(id) ON DELETE CASCADE;


--
-- Name: oauth_consents oauth_consents_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.oauth_consents
    ADD CONSTRAINT oauth_consents_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: one_time_tokens one_time_tokens_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.one_time_tokens
    ADD CONSTRAINT one_time_tokens_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: refresh_tokens refresh_tokens_session_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.refresh_tokens
    ADD CONSTRAINT refresh_tokens_session_id_fkey FOREIGN KEY (session_id) REFERENCES auth.sessions(id) ON DELETE CASCADE;


--
-- Name: saml_providers saml_providers_sso_provider_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.saml_providers
    ADD CONSTRAINT saml_providers_sso_provider_id_fkey FOREIGN KEY (sso_provider_id) REFERENCES auth.sso_providers(id) ON DELETE CASCADE;


--
-- Name: saml_relay_states saml_relay_states_flow_state_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.saml_relay_states
    ADD CONSTRAINT saml_relay_states_flow_state_id_fkey FOREIGN KEY (flow_state_id) REFERENCES auth.flow_state(id) ON DELETE CASCADE;


--
-- Name: saml_relay_states saml_relay_states_sso_provider_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.saml_relay_states
    ADD CONSTRAINT saml_relay_states_sso_provider_id_fkey FOREIGN KEY (sso_provider_id) REFERENCES auth.sso_providers(id) ON DELETE CASCADE;


--
-- Name: sessions sessions_oauth_client_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.sessions
    ADD CONSTRAINT sessions_oauth_client_id_fkey FOREIGN KEY (oauth_client_id) REFERENCES auth.oauth_clients(id) ON DELETE CASCADE;


--
-- Name: sessions sessions_user_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.sessions
    ADD CONSTRAINT sessions_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: sso_domains sso_domains_sso_provider_id_fkey; Type: FK CONSTRAINT; Schema: auth; Owner: -
--

ALTER TABLE ONLY auth.sso_domains
    ADD CONSTRAINT sso_domains_sso_provider_id_fkey FOREIGN KEY (sso_provider_id) REFERENCES auth.sso_providers(id) ON DELETE CASCADE;


--
-- Name: activity_logs activity_logs_studio_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.activity_logs
    ADD CONSTRAINT activity_logs_studio_id_fkey FOREIGN KEY (studio_id) REFERENCES public.studios(id) ON DELETE SET NULL;


--
-- Name: activity_logs activity_logs_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.activity_logs
    ADD CONSTRAINT activity_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.user_profiles(id) ON DELETE CASCADE;


--
-- Name: age_groups age_groups_tenant_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.age_groups
    ADD CONSTRAINT age_groups_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE CASCADE;


--
-- Name: awards awards_award_type_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.awards
    ADD CONSTRAINT awards_award_type_id_fkey FOREIGN KEY (award_type_id) REFERENCES public.award_types(id);


--
-- Name: awards awards_competition_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.awards
    ADD CONSTRAINT awards_competition_id_fkey FOREIGN KEY (competition_id) REFERENCES public.competitions(id) ON DELETE CASCADE;


--
-- Name: awards awards_entry_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.awards
    ADD CONSTRAINT awards_entry_id_fkey FOREIGN KEY (entry_id) REFERENCES public.competition_entries(id) ON DELETE CASCADE;


--
-- Name: capacity_ledger capacity_ledger_competition_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.capacity_ledger
    ADD CONSTRAINT capacity_ledger_competition_id_fkey FOREIGN KEY (competition_id) REFERENCES public.competitions(id) ON DELETE CASCADE;


--
-- Name: capacity_ledger capacity_ledger_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.capacity_ledger
    ADD CONSTRAINT capacity_ledger_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id);


--
-- Name: capacity_ledger capacity_ledger_reservation_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.capacity_ledger
    ADD CONSTRAINT capacity_ledger_reservation_id_fkey FOREIGN KEY (reservation_id) REFERENCES public.reservations(id) ON DELETE SET NULL;


--
-- Name: classification_exception_requests classification_exception_requ_auto_calculated_classificati_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.classification_exception_requests
    ADD CONSTRAINT classification_exception_requ_auto_calculated_classificati_fkey FOREIGN KEY (auto_calculated_classification_id) REFERENCES public.classifications(id);


--
-- Name: classification_exception_requests classification_exception_reque_requested_classification_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.classification_exception_requests
    ADD CONSTRAINT classification_exception_reque_requested_classification_id_fkey FOREIGN KEY (requested_classification_id) REFERENCES public.classifications(id);


--
-- Name: classification_exception_requests classification_exception_reques_approved_classification_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.classification_exception_requests
    ADD CONSTRAINT classification_exception_reques_approved_classification_id_fkey FOREIGN KEY (approved_classification_id) REFERENCES public.classifications(id);


--
-- Name: classification_exception_requests classification_exception_requests_competition_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.classification_exception_requests
    ADD CONSTRAINT classification_exception_requests_competition_id_fkey FOREIGN KEY (competition_id) REFERENCES public.competitions(id);


--
-- Name: classification_exception_requests classification_exception_requests_created_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.classification_exception_requests
    ADD CONSTRAINT classification_exception_requests_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.user_profiles(id);


--
-- Name: classification_exception_requests classification_exception_requests_entry_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.classification_exception_requests
    ADD CONSTRAINT classification_exception_requests_entry_id_fkey FOREIGN KEY (entry_id) REFERENCES public.competition_entries(id) ON DELETE CASCADE;


--
-- Name: classification_exception_requests classification_exception_requests_reservation_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.classification_exception_requests
    ADD CONSTRAINT classification_exception_requests_reservation_id_fkey FOREIGN KEY (reservation_id) REFERENCES public.reservations(id);


--
-- Name: classification_exception_requests classification_exception_requests_responded_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.classification_exception_requests
    ADD CONSTRAINT classification_exception_requests_responded_by_fkey FOREIGN KEY (responded_by) REFERENCES public.user_profiles(id);


--
-- Name: classification_exception_requests classification_exception_requests_studio_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.classification_exception_requests
    ADD CONSTRAINT classification_exception_requests_studio_id_fkey FOREIGN KEY (studio_id) REFERENCES public.studios(id);


--
-- Name: classification_exception_requests classification_exception_requests_tenant_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.classification_exception_requests
    ADD CONSTRAINT classification_exception_requests_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id);


--
-- Name: competition_entries competition_entries_age_group_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.competition_entries
    ADD CONSTRAINT competition_entries_age_group_id_fkey FOREIGN KEY (age_group_id) REFERENCES public.age_groups(id);


--
-- Name: competition_entries competition_entries_category_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.competition_entries
    ADD CONSTRAINT competition_entries_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.dance_categories(id);


--
-- Name: competition_entries competition_entries_classification_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.competition_entries
    ADD CONSTRAINT competition_entries_classification_id_fkey FOREIGN KEY (classification_id) REFERENCES public.classifications(id);


--
-- Name: competition_entries competition_entries_competition_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.competition_entries
    ADD CONSTRAINT competition_entries_competition_id_fkey FOREIGN KEY (competition_id) REFERENCES public.competitions(id) ON DELETE CASCADE;


--
-- Name: competition_entries competition_entries_entry_size_category_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.competition_entries
    ADD CONSTRAINT competition_entries_entry_size_category_id_fkey FOREIGN KEY (entry_size_category_id) REFERENCES public.entry_size_categories(id);


--
-- Name: competition_entries competition_entries_next_entry_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.competition_entries
    ADD CONSTRAINT competition_entries_next_entry_id_fkey FOREIGN KEY (next_entry_id) REFERENCES public.competition_entries(id);


--
-- Name: competition_entries competition_entries_previous_entry_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.competition_entries
    ADD CONSTRAINT competition_entries_previous_entry_id_fkey FOREIGN KEY (previous_entry_id) REFERENCES public.competition_entries(id);


--
-- Name: competition_entries competition_entries_reservation_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.competition_entries
    ADD CONSTRAINT competition_entries_reservation_id_fkey FOREIGN KEY (reservation_id) REFERENCES public.reservations(id) ON DELETE CASCADE;


--
-- Name: competition_entries competition_entries_session_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.competition_entries
    ADD CONSTRAINT competition_entries_session_id_fkey FOREIGN KEY (session_id) REFERENCES public.competition_sessions(id);


--
-- Name: competition_entries competition_entries_studio_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.competition_entries
    ADD CONSTRAINT competition_entries_studio_id_fkey FOREIGN KEY (studio_id) REFERENCES public.studios(id) ON DELETE CASCADE;


--
-- Name: competition_entries competition_entries_tenant_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.competition_entries
    ADD CONSTRAINT competition_entries_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: competition_locations competition_locations_competition_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.competition_locations
    ADD CONSTRAINT competition_locations_competition_id_fkey FOREIGN KEY (competition_id) REFERENCES public.competitions(id) ON DELETE CASCADE;


--
-- Name: competition_sessions competition_sessions_competition_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.competition_sessions
    ADD CONSTRAINT competition_sessions_competition_id_fkey FOREIGN KEY (competition_id) REFERENCES public.competitions(id) ON DELETE CASCADE;


--
-- Name: competition_sessions competition_sessions_head_judge_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.competition_sessions
    ADD CONSTRAINT competition_sessions_head_judge_fkey FOREIGN KEY (head_judge) REFERENCES auth.users(id);


--
-- Name: competition_sessions competition_sessions_location_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.competition_sessions
    ADD CONSTRAINT competition_sessions_location_id_fkey FOREIGN KEY (location_id) REFERENCES public.competition_locations(id) ON DELETE CASCADE;


--
-- Name: competitions competitions_tenant_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.competitions
    ADD CONSTRAINT competitions_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: dance_categories dance_categories_tenant_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dance_categories
    ADD CONSTRAINT dance_categories_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE CASCADE;


--
-- Name: dancers dancers_classification_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dancers
    ADD CONSTRAINT dancers_classification_id_fkey FOREIGN KEY (classification_id) REFERENCES public.classifications(id);


--
-- Name: dancers dancers_studio_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dancers
    ADD CONSTRAINT dancers_studio_id_fkey FOREIGN KEY (studio_id) REFERENCES public.studios(id) ON DELETE CASCADE;


--
-- Name: dancers dancers_tenant_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.dancers
    ADD CONSTRAINT dancers_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: documents documents_competition_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.documents
    ADD CONSTRAINT documents_competition_id_fkey FOREIGN KEY (competition_id) REFERENCES public.competitions(id) ON DELETE CASCADE;


--
-- Name: documents documents_entry_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.documents
    ADD CONSTRAINT documents_entry_id_fkey FOREIGN KEY (entry_id) REFERENCES public.competition_entries(id) ON DELETE CASCADE;


--
-- Name: documents documents_studio_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.documents
    ADD CONSTRAINT documents_studio_id_fkey FOREIGN KEY (studio_id) REFERENCES public.studios(id) ON DELETE CASCADE;


--
-- Name: documents documents_uploaded_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.documents
    ADD CONSTRAINT documents_uploaded_by_fkey FOREIGN KEY (uploaded_by) REFERENCES auth.users(id);


--
-- Name: elite_instructors elite_instructors_competition_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.elite_instructors
    ADD CONSTRAINT elite_instructors_competition_id_fkey FOREIGN KEY (competition_id) REFERENCES public.competitions(id) ON DELETE CASCADE;


--
-- Name: email_preferences email_preferences_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_preferences
    ADD CONSTRAINT email_preferences_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.user_profiles(id) ON DELETE CASCADE;


--
-- Name: email_queue email_queue_tenant_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_queue
    ADD CONSTRAINT email_queue_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE CASCADE;


--
-- Name: email_queue email_queue_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_queue
    ADD CONSTRAINT email_queue_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: entry_participants entry_participants_dancer_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.entry_participants
    ADD CONSTRAINT entry_participants_dancer_id_fkey FOREIGN KEY (dancer_id) REFERENCES public.dancers(id) ON DELETE CASCADE;


--
-- Name: entry_participants entry_participants_entry_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.entry_participants
    ADD CONSTRAINT entry_participants_entry_id_fkey FOREIGN KEY (entry_id) REFERENCES public.competition_entries(id) ON DELETE CASCADE;


--
-- Name: entry_size_categories entry_size_categories_tenant_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.entry_size_categories
    ADD CONSTRAINT entry_size_categories_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE CASCADE;


--
-- Name: activity_logs fk_activity_logs_tenant; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.activity_logs
    ADD CONSTRAINT fk_activity_logs_tenant FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE RESTRICT;


--
-- Name: award_types fk_award_types_tenant; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.award_types
    ADD CONSTRAINT fk_award_types_tenant FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE RESTRICT;


--
-- Name: awards fk_awards_tenant; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.awards
    ADD CONSTRAINT fk_awards_tenant FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE RESTRICT;


--
-- Name: capacity_ledger fk_capacity_ledger_tenant; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.capacity_ledger
    ADD CONSTRAINT fk_capacity_ledger_tenant FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE RESTRICT;


--
-- Name: classifications fk_classifications_tenant; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.classifications
    ADD CONSTRAINT fk_classifications_tenant FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE RESTRICT;


--
-- Name: competition_locations fk_competition_locations_tenant; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.competition_locations
    ADD CONSTRAINT fk_competition_locations_tenant FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE RESTRICT;


--
-- Name: competition_sessions fk_competition_sessions_tenant; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.competition_sessions
    ADD CONSTRAINT fk_competition_sessions_tenant FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE RESTRICT;


--
-- Name: documents fk_documents_tenant; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.documents
    ADD CONSTRAINT fk_documents_tenant FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE RESTRICT;


--
-- Name: email_logs fk_email_logs_competition; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_logs
    ADD CONSTRAINT fk_email_logs_competition FOREIGN KEY (competition_id) REFERENCES public.competitions(id) ON DELETE SET NULL;


--
-- Name: email_logs fk_email_logs_studio; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_logs
    ADD CONSTRAINT fk_email_logs_studio FOREIGN KEY (studio_id) REFERENCES public.studios(id) ON DELETE SET NULL;


--
-- Name: email_logs fk_email_logs_tenant; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_logs
    ADD CONSTRAINT fk_email_logs_tenant FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE RESTRICT;


--
-- Name: email_preferences fk_email_preferences_tenant; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_preferences
    ADD CONSTRAINT fk_email_preferences_tenant FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE RESTRICT;


--
-- Name: email_templates fk_email_templates_tenant; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.email_templates
    ADD CONSTRAINT fk_email_templates_tenant FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE RESTRICT;


--
-- Name: entry_participants fk_entry_participants_tenant; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.entry_participants
    ADD CONSTRAINT fk_entry_participants_tenant FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE RESTRICT;


--
-- Name: judges fk_judges_tenant; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.judges
    ADD CONSTRAINT fk_judges_tenant FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE RESTRICT;


--
-- Name: rankings fk_rankings_tenant; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.rankings
    ADD CONSTRAINT fk_rankings_tenant FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE RESTRICT;


--
-- Name: routine_import_sessions fk_reservation; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.routine_import_sessions
    ADD CONSTRAINT fk_reservation FOREIGN KEY (reservation_id) REFERENCES public.reservations(id) ON DELETE CASCADE;


--
-- Name: scores fk_scores_tenant; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.scores
    ADD CONSTRAINT fk_scores_tenant FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE RESTRICT;


--
-- Name: routine_import_sessions fk_studio; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.routine_import_sessions
    ADD CONSTRAINT fk_studio FOREIGN KEY (studio_id) REFERENCES public.studios(id) ON DELETE CASCADE;


--
-- Name: summaries fk_summaries_tenant; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.summaries
    ADD CONSTRAINT fk_summaries_tenant FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE RESTRICT;


--
-- Name: summary_entries fk_summary_entries_tenant; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.summary_entries
    ADD CONSTRAINT fk_summary_entries_tenant FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE RESTRICT;


--
-- Name: title_rounds fk_title_rounds_tenant; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.title_rounds
    ADD CONSTRAINT fk_title_rounds_tenant FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE RESTRICT;


--
-- Name: vip_events fk_vip_events_tenant; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vip_events
    ADD CONSTRAINT fk_vip_events_tenant FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE RESTRICT;


--
-- Name: invoices invoices_competition_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoices
    ADD CONSTRAINT invoices_competition_id_fkey FOREIGN KEY (competition_id) REFERENCES public.competitions(id) ON DELETE CASCADE;


--
-- Name: invoices invoices_reservation_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoices
    ADD CONSTRAINT invoices_reservation_id_fkey FOREIGN KEY (reservation_id) REFERENCES public.reservations(id) ON DELETE SET NULL;


--
-- Name: invoices invoices_studio_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoices
    ADD CONSTRAINT invoices_studio_id_fkey FOREIGN KEY (studio_id) REFERENCES public.studios(id) ON DELETE CASCADE;


--
-- Name: invoices invoices_tenant_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.invoices
    ADD CONSTRAINT invoices_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: judges judges_competition_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.judges
    ADD CONSTRAINT judges_competition_id_fkey FOREIGN KEY (competition_id) REFERENCES public.competitions(id) ON DELETE CASCADE;


--
-- Name: judges judges_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.judges
    ADD CONSTRAINT judges_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: rankings rankings_age_group_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.rankings
    ADD CONSTRAINT rankings_age_group_id_fkey FOREIGN KEY (age_group_id) REFERENCES public.age_groups(id);


--
-- Name: rankings rankings_category_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.rankings
    ADD CONSTRAINT rankings_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.dance_categories(id);


--
-- Name: rankings rankings_classification_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.rankings
    ADD CONSTRAINT rankings_classification_id_fkey FOREIGN KEY (classification_id) REFERENCES public.classifications(id);


--
-- Name: rankings rankings_competition_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.rankings
    ADD CONSTRAINT rankings_competition_id_fkey FOREIGN KEY (competition_id) REFERENCES public.competitions(id) ON DELETE CASCADE;


--
-- Name: rankings rankings_entry_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.rankings
    ADD CONSTRAINT rankings_entry_id_fkey FOREIGN KEY (entry_id) REFERENCES public.competition_entries(id) ON DELETE CASCADE;


--
-- Name: reservations reservations_approved_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.reservations
    ADD CONSTRAINT reservations_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES auth.users(id);


--
-- Name: reservations reservations_competition_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.reservations
    ADD CONSTRAINT reservations_competition_id_fkey FOREIGN KEY (competition_id) REFERENCES public.competitions(id) ON DELETE CASCADE;


--
-- Name: reservations reservations_location_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.reservations
    ADD CONSTRAINT reservations_location_id_fkey FOREIGN KEY (location_id) REFERENCES public.competition_locations(id) ON DELETE CASCADE;


--
-- Name: reservations reservations_payment_confirmed_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.reservations
    ADD CONSTRAINT reservations_payment_confirmed_by_fkey FOREIGN KEY (payment_confirmed_by) REFERENCES auth.users(id);


--
-- Name: reservations reservations_studio_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.reservations
    ADD CONSTRAINT reservations_studio_id_fkey FOREIGN KEY (studio_id) REFERENCES public.studios(id) ON DELETE CASCADE;


--
-- Name: reservations reservations_tenant_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.reservations
    ADD CONSTRAINT reservations_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: scores scores_entry_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.scores
    ADD CONSTRAINT scores_entry_id_fkey FOREIGN KEY (entry_id) REFERENCES public.competition_entries(id) ON DELETE CASCADE;


--
-- Name: scores scores_judge_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.scores
    ADD CONSTRAINT scores_judge_id_fkey FOREIGN KEY (judge_id) REFERENCES public.judges(id) ON DELETE CASCADE;


--
-- Name: scoring_tiers scoring_tiers_tenant_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.scoring_tiers
    ADD CONSTRAINT scoring_tiers_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON DELETE RESTRICT;


--
-- Name: studios studios_owner_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.studios
    ADD CONSTRAINT studios_owner_id_fkey FOREIGN KEY (owner_id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: studios studios_tenant_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.studios
    ADD CONSTRAINT studios_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: studios studios_verified_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.studios
    ADD CONSTRAINT studios_verified_by_fkey FOREIGN KEY (verified_by) REFERENCES auth.users(id);


--
-- Name: summaries summaries_reservation_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.summaries
    ADD CONSTRAINT summaries_reservation_id_fkey FOREIGN KEY (reservation_id) REFERENCES public.reservations(id) ON DELETE CASCADE;


--
-- Name: summary_entries summary_entries_entry_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.summary_entries
    ADD CONSTRAINT summary_entries_entry_id_fkey FOREIGN KEY (entry_id) REFERENCES public.competition_entries(id) ON DELETE CASCADE;


--
-- Name: summary_entries summary_entries_summary_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.summary_entries
    ADD CONSTRAINT summary_entries_summary_id_fkey FOREIGN KEY (summary_id) REFERENCES public.summaries(id) ON DELETE CASCADE;


--
-- Name: title_rounds title_rounds_competition_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.title_rounds
    ADD CONSTRAINT title_rounds_competition_id_fkey FOREIGN KEY (competition_id) REFERENCES public.competitions(id) ON DELETE CASCADE;


--
-- Name: title_rounds title_rounds_session_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.title_rounds
    ADD CONSTRAINT title_rounds_session_id_fkey FOREIGN KEY (session_id) REFERENCES public.competition_sessions(id);


--
-- Name: two_factor_audit_log two_factor_audit_log_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.two_factor_audit_log
    ADD CONSTRAINT two_factor_audit_log_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.user_profiles(id) ON DELETE CASCADE;


--
-- Name: user_profiles user_profiles_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_profiles
    ADD CONSTRAINT user_profiles_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id) ON DELETE CASCADE;


--
-- Name: user_profiles user_profiles_tenant_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_profiles
    ADD CONSTRAINT user_profiles_tenant_id_fkey FOREIGN KEY (tenant_id) REFERENCES public.tenants(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- Name: vip_events vip_events_competition_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.vip_events
    ADD CONSTRAINT vip_events_competition_id_fkey FOREIGN KEY (competition_id) REFERENCES public.competitions(id) ON DELETE CASCADE;


--
-- Name: objects objects_bucketId_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: -
--

ALTER TABLE ONLY storage.objects
    ADD CONSTRAINT "objects_bucketId_fkey" FOREIGN KEY (bucket_id) REFERENCES storage.buckets(id);


--
-- Name: prefixes prefixes_bucketId_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: -
--

ALTER TABLE ONLY storage.prefixes
    ADD CONSTRAINT "prefixes_bucketId_fkey" FOREIGN KEY (bucket_id) REFERENCES storage.buckets(id);


--
-- Name: s3_multipart_uploads s3_multipart_uploads_bucket_id_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: -
--

ALTER TABLE ONLY storage.s3_multipart_uploads
    ADD CONSTRAINT s3_multipart_uploads_bucket_id_fkey FOREIGN KEY (bucket_id) REFERENCES storage.buckets(id);


--
-- Name: s3_multipart_uploads_parts s3_multipart_uploads_parts_bucket_id_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: -
--

ALTER TABLE ONLY storage.s3_multipart_uploads_parts
    ADD CONSTRAINT s3_multipart_uploads_parts_bucket_id_fkey FOREIGN KEY (bucket_id) REFERENCES storage.buckets(id);


--
-- Name: s3_multipart_uploads_parts s3_multipart_uploads_parts_upload_id_fkey; Type: FK CONSTRAINT; Schema: storage; Owner: -
--

ALTER TABLE ONLY storage.s3_multipart_uploads_parts
    ADD CONSTRAINT s3_multipart_uploads_parts_upload_id_fkey FOREIGN KEY (upload_id) REFERENCES storage.s3_multipart_uploads(id) ON DELETE CASCADE;


--
-- Name: audit_log_entries; Type: ROW SECURITY; Schema: auth; Owner: -
--

ALTER TABLE auth.audit_log_entries ENABLE ROW LEVEL SECURITY;

--
-- Name: flow_state; Type: ROW SECURITY; Schema: auth; Owner: -
--

ALTER TABLE auth.flow_state ENABLE ROW LEVEL SECURITY;

--
-- Name: identities; Type: ROW SECURITY; Schema: auth; Owner: -
--

ALTER TABLE auth.identities ENABLE ROW LEVEL SECURITY;

--
-- Name: instances; Type: ROW SECURITY; Schema: auth; Owner: -
--

ALTER TABLE auth.instances ENABLE ROW LEVEL SECURITY;

--
-- Name: mfa_amr_claims; Type: ROW SECURITY; Schema: auth; Owner: -
--

ALTER TABLE auth.mfa_amr_claims ENABLE ROW LEVEL SECURITY;

--
-- Name: mfa_challenges; Type: ROW SECURITY; Schema: auth; Owner: -
--

ALTER TABLE auth.mfa_challenges ENABLE ROW LEVEL SECURITY;

--
-- Name: mfa_factors; Type: ROW SECURITY; Schema: auth; Owner: -
--

ALTER TABLE auth.mfa_factors ENABLE ROW LEVEL SECURITY;

--
-- Name: one_time_tokens; Type: ROW SECURITY; Schema: auth; Owner: -
--

ALTER TABLE auth.one_time_tokens ENABLE ROW LEVEL SECURITY;

--
-- Name: refresh_tokens; Type: ROW SECURITY; Schema: auth; Owner: -
--

ALTER TABLE auth.refresh_tokens ENABLE ROW LEVEL SECURITY;

--
-- Name: saml_providers; Type: ROW SECURITY; Schema: auth; Owner: -
--

ALTER TABLE auth.saml_providers ENABLE ROW LEVEL SECURITY;

--
-- Name: saml_relay_states; Type: ROW SECURITY; Schema: auth; Owner: -
--

ALTER TABLE auth.saml_relay_states ENABLE ROW LEVEL SECURITY;

--
-- Name: schema_migrations; Type: ROW SECURITY; Schema: auth; Owner: -
--

ALTER TABLE auth.schema_migrations ENABLE ROW LEVEL SECURITY;

--
-- Name: sessions; Type: ROW SECURITY; Schema: auth; Owner: -
--

ALTER TABLE auth.sessions ENABLE ROW LEVEL SECURITY;

--
-- Name: sso_domains; Type: ROW SECURITY; Schema: auth; Owner: -
--

ALTER TABLE auth.sso_domains ENABLE ROW LEVEL SECURITY;

--
-- Name: sso_providers; Type: ROW SECURITY; Schema: auth; Owner: -
--

ALTER TABLE auth.sso_providers ENABLE ROW LEVEL SECURITY;

--
-- Name: users; Type: ROW SECURITY; Schema: auth; Owner: -
--

ALTER TABLE auth.users ENABLE ROW LEVEL SECURITY;

--
-- Name: invoices Admins can create invoices; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Admins can create invoices" ON public.invoices FOR INSERT WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: invoices Admins can delete invoices; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Admins can delete invoices" ON public.invoices FOR DELETE USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: age_groups Admins can manage age groups; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Admins can manage age groups" ON public.age_groups USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = 'super_admin'::public.user_role))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = 'super_admin'::public.user_role)))));


--
-- Name: award_types Admins can manage award types; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Admins can manage award types" ON public.award_types USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = 'super_admin'::public.user_role))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = 'super_admin'::public.user_role)))));


--
-- Name: dance_categories Admins can manage categories; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Admins can manage categories" ON public.dance_categories USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = 'super_admin'::public.user_role))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = 'super_admin'::public.user_role)))));


--
-- Name: classifications Admins can manage classifications; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Admins can manage classifications" ON public.classifications USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = 'super_admin'::public.user_role))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = 'super_admin'::public.user_role)))));


--
-- Name: entry_size_categories Admins can manage size categories; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Admins can manage size categories" ON public.entry_size_categories USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = 'super_admin'::public.user_role))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = 'super_admin'::public.user_role)))));


--
-- Name: system_settings Admins can manage system settings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Admins can manage system settings" ON public.system_settings USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = 'super_admin'::public.user_role))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = 'super_admin'::public.user_role)))));


--
-- Name: invoices Admins can update invoices; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Admins can update invoices" ON public.invoices FOR UPDATE USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: activity_logs Authenticated users can create activity logs; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can create activity logs" ON public.activity_logs FOR INSERT TO authenticated WITH CHECK ((user_id = ( SELECT auth.uid() AS uid)));


--
-- Name: age_groups Authenticated users can view age groups; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view age groups" ON public.age_groups FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: award_types Authenticated users can view award types; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view award types" ON public.award_types FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: dance_categories Authenticated users can view categories; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view categories" ON public.dance_categories FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: classifications Authenticated users can view classifications; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view classifications" ON public.classifications FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: competition_settings Authenticated users can view competition settings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view competition settings" ON public.competition_settings FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: competitions Authenticated users can view competitions; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view competitions" ON public.competitions FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: elite_instructors Authenticated users can view elite instructors; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view elite instructors" ON public.elite_instructors FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: email_templates Authenticated users can view email templates; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view email templates" ON public.email_templates FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: judges Authenticated users can view judges; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view judges" ON public.judges FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: competition_locations Authenticated users can view locations; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view locations" ON public.competition_locations FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: competition_sessions Authenticated users can view sessions; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view sessions" ON public.competition_sessions FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: entry_size_categories Authenticated users can view size categories; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view size categories" ON public.entry_size_categories FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: system_settings Authenticated users can view system settings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view system settings" ON public.system_settings FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: title_rounds Authenticated users can view title rounds; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view title rounds" ON public.title_rounds FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: vip_events Authenticated users can view vip events; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Authenticated users can view vip events" ON public.vip_events FOR SELECT USING ((( SELECT auth.uid() AS uid) IS NOT NULL));


--
-- Name: classification_exception_requests Competition Directors can update classification requests; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Competition Directors can update classification requests" ON public.classification_exception_requests FOR UPDATE USING ((tenant_id IN ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: classification_exception_requests Competition Directors can view classification requests; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Competition Directors can view classification requests" ON public.classification_exception_requests FOR SELECT USING ((tenant_id IN ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: scoring_tiers Competition directors can manage scoring tiers; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Competition directors can manage scoring tiers" ON public.scoring_tiers USING (((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))) AND (EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))));


--
-- Name: awards Directors and admins can delete awards; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can delete awards" ON public.awards FOR DELETE USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: competition_settings Directors and admins can delete competition settings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can delete competition settings" ON public.competition_settings FOR DELETE USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: rankings Directors and admins can delete rankings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can delete rankings" ON public.rankings FOR DELETE USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: awards Directors and admins can insert awards; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can insert awards" ON public.awards FOR INSERT WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: competition_settings Directors and admins can insert competition settings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can insert competition settings" ON public.competition_settings FOR INSERT WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: rankings Directors and admins can insert rankings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can insert rankings" ON public.rankings FOR INSERT WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: competitions Directors and admins can manage competitions; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can manage competitions" ON public.competitions USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: elite_instructors Directors and admins can manage elite instructors; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can manage elite instructors" ON public.elite_instructors USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: email_templates Directors and admins can manage email templates; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can manage email templates" ON public.email_templates USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: judges Directors and admins can manage judges; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can manage judges" ON public.judges USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: competition_locations Directors and admins can manage locations; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can manage locations" ON public.competition_locations USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: competition_sessions Directors and admins can manage sessions; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can manage sessions" ON public.competition_sessions USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: title_rounds Directors and admins can manage title rounds; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can manage title rounds" ON public.title_rounds USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: vip_events Directors and admins can manage vip events; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can manage vip events" ON public.vip_events USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))) WITH CHECK ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: awards Directors and admins can update awards; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can update awards" ON public.awards FOR UPDATE USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: competition_settings Directors and admins can update competition settings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can update competition settings" ON public.competition_settings FOR UPDATE USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: rankings Directors and admins can update rankings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can update rankings" ON public.rankings FOR UPDATE USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: awards Directors and admins can view all awards; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can view all awards" ON public.awards FOR SELECT USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: rankings Directors and admins can view all rankings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Directors and admins can view all rankings" ON public.rankings FOR SELECT USING ((EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role]))))));


--
-- Name: documents Document access control; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Document access control" ON public.documents USING (((studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.owner_id = auth.uid()))) OR (uploaded_by = auth.uid()) OR (EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))));


--
-- Name: entry_participants Entry participant access; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Entry participant access" ON public.entry_participants USING (((EXISTS ( SELECT 1
   FROM public.competition_entries e
  WHERE ((e.id = entry_participants.entry_id) AND (e.studio_id IN ( SELECT studios.id
           FROM public.studios
          WHERE (studios.owner_id = auth.uid())))))) OR (EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))));


--
-- Name: awards Judges can view competition awards; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Judges can view competition awards" ON public.awards FOR SELECT USING ((competition_id IN ( SELECT judges.competition_id
   FROM public.judges
  WHERE (judges.user_id = ( SELECT auth.uid() AS uid)))));


--
-- Name: rankings Judges can view competition rankings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Judges can view competition rankings" ON public.rankings FOR SELECT USING ((competition_id IN ( SELECT judges.competition_id
   FROM public.judges
  WHERE (judges.user_id = ( SELECT auth.uid() AS uid)))));


--
-- Name: email_logs Service can insert email logs; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Service can insert email logs" ON public.email_logs FOR INSERT WITH CHECK (true);


--
-- Name: email_queue Service role full access to email_queue; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Service role full access to email_queue" ON public.email_queue TO service_role USING (true) WITH CHECK (true);


--
-- Name: classification_exception_requests Studio Directors can create classification requests; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Studio Directors can create classification requests" ON public.classification_exception_requests FOR INSERT WITH CHECK (((studio_id IN ( SELECT classification_exception_requests.studio_id
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = 'studio_director'::public.user_role)))) AND (tenant_id IN ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid())))));


--
-- Name: classification_exception_requests Studio Directors can delete pending requests; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Studio Directors can delete pending requests" ON public.classification_exception_requests FOR DELETE USING (((studio_id IN ( SELECT classification_exception_requests.studio_id
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = 'studio_director'::public.user_role)))) AND ((status)::text = 'pending'::text)));


--
-- Name: classification_exception_requests Studio Directors can view their classification requests; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Studio Directors can view their classification requests" ON public.classification_exception_requests FOR SELECT USING ((studio_id IN ( SELECT classification_exception_requests.studio_id
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = 'studio_director'::public.user_role)))));


--
-- Name: dancers Studio access to dancers; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Studio access to dancers" ON public.dancers USING ((studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.owner_id = auth.uid()))));


--
-- Name: competition_entries Studio access to entries; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Studio access to entries" ON public.competition_entries USING (((studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.owner_id = auth.uid()))) OR (EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))));


--
-- Name: reservations Studio access to reservations; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Studio access to reservations" ON public.reservations USING (((studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.owner_id = auth.uid()))) OR (EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))));


--
-- Name: studios Studio owners can view own studios; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Studio owners can view own studios" ON public.studios FOR SELECT USING (((owner_id = ( SELECT auth.uid() AS uid)) OR (EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))));


--
-- Name: awards Studios can view own awards; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Studios can view own awards" ON public.awards FOR SELECT USING ((entry_id IN ( SELECT e.id
   FROM public.competition_entries e
  WHERE (e.studio_id IN ( SELECT studios.id
           FROM public.studios
          WHERE (studios.owner_id = auth.uid()))))));


--
-- Name: rankings Studios can view own rankings; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Studios can view own rankings" ON public.rankings FOR SELECT USING ((entry_id IN ( SELECT e.id
   FROM public.competition_entries e
  WHERE (e.studio_id IN ( SELECT studios.id
           FROM public.studios
          WHERE (studios.owner_id = auth.uid()))))));


--
-- Name: activity_logs Studios can view studio activities; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Studios can view studio activities" ON public.activity_logs FOR SELECT USING ((studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.owner_id = ( SELECT auth.uid() AS uid)))));


--
-- Name: studios Users can create own studio; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Users can create own studio" ON public.studios FOR INSERT TO authenticated WITH CHECK ((owner_id = auth.uid()));


--
-- Name: studios Users can delete own studio; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Users can delete own studio" ON public.studios FOR DELETE TO authenticated USING ((owner_id = auth.uid()));


--
-- Name: email_preferences Users can update own email preferences; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Users can update own email preferences" ON public.email_preferences USING ((auth.uid() = user_id));


--
-- Name: user_profiles Users can update own profile; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Users can update own profile" ON public.user_profiles FOR UPDATE USING ((id = ( SELECT auth.uid() AS uid)));


--
-- Name: studios Users can update own studio; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Users can update own studio" ON public.studios FOR UPDATE TO authenticated USING ((owner_id = auth.uid())) WITH CHECK ((owner_id = auth.uid()));


--
-- Name: activity_logs Users can view own activities; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Users can view own activities" ON public.activity_logs FOR SELECT USING ((user_id = ( SELECT auth.uid() AS uid)));


--
-- Name: email_preferences Users can view own email preferences; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Users can view own email preferences" ON public.email_preferences FOR SELECT USING ((auth.uid() = user_id));


--
-- Name: email_queue Users can view own emails; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Users can view own emails" ON public.email_queue FOR SELECT TO authenticated USING ((user_id = auth.uid()));


--
-- Name: user_profiles Users can view own profile; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Users can view own profile" ON public.user_profiles FOR SELECT USING ((id = ( SELECT auth.uid() AS uid)));


--
-- Name: scoring_tiers Users can view scoring tiers for their tenant; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "Users can view scoring tiers for their tenant" ON public.scoring_tiers FOR SELECT USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: email_logs View email logs; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "View email logs" ON public.email_logs FOR SELECT USING (((studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.owner_id = auth.uid()))) OR (EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))));


--
-- Name: invoices View invoices; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY "View invoices" ON public.invoices FOR SELECT USING (((studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.owner_id = auth.uid()))) OR (EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = auth.uid()) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))));


--
-- Name: activity_logs; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.activity_logs ENABLE ROW LEVEL SECURITY;

--
-- Name: activity_logs activity_logs_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY activity_logs_service_role ON public.activity_logs TO service_role USING (true) WITH CHECK (true);


--
-- Name: activity_logs activity_logs_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY activity_logs_tenant_isolation ON public.activity_logs TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: age_groups; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.age_groups ENABLE ROW LEVEL SECURITY;

--
-- Name: award_types; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.award_types ENABLE ROW LEVEL SECURITY;

--
-- Name: award_types award_types_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY award_types_service_role ON public.award_types TO service_role USING (true) WITH CHECK (true);


--
-- Name: award_types award_types_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY award_types_tenant_isolation ON public.award_types TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: awards; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.awards ENABLE ROW LEVEL SECURITY;

--
-- Name: awards awards_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY awards_service_role ON public.awards TO service_role USING (true) WITH CHECK (true);


--
-- Name: awards awards_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY awards_tenant_isolation ON public.awards TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: capacity_ledger; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.capacity_ledger ENABLE ROW LEVEL SECURITY;

--
-- Name: capacity_ledger capacity_ledger_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY capacity_ledger_service_role ON public.capacity_ledger TO service_role USING (true) WITH CHECK (true);


--
-- Name: capacity_ledger capacity_ledger_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY capacity_ledger_tenant_isolation ON public.capacity_ledger TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: classification_exception_requests; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.classification_exception_requests ENABLE ROW LEVEL SECURITY;

--
-- Name: classifications; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.classifications ENABLE ROW LEVEL SECURITY;

--
-- Name: classifications classifications_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY classifications_service_role ON public.classifications TO service_role USING (true) WITH CHECK (true);


--
-- Name: classifications classifications_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY classifications_tenant_isolation ON public.classifications TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: competition_entries; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.competition_entries ENABLE ROW LEVEL SECURITY;

--
-- Name: competition_locations; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.competition_locations ENABLE ROW LEVEL SECURITY;

--
-- Name: competition_locations competition_locations_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY competition_locations_service_role ON public.competition_locations TO service_role USING (true) WITH CHECK (true);


--
-- Name: competition_locations competition_locations_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY competition_locations_tenant_isolation ON public.competition_locations TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: competition_sessions; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.competition_sessions ENABLE ROW LEVEL SECURITY;

--
-- Name: competition_sessions competition_sessions_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY competition_sessions_service_role ON public.competition_sessions TO service_role USING (true) WITH CHECK (true);


--
-- Name: competition_sessions competition_sessions_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY competition_sessions_tenant_isolation ON public.competition_sessions TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: competition_settings; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.competition_settings ENABLE ROW LEVEL SECURITY;

--
-- Name: competitions; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.competitions ENABLE ROW LEVEL SECURITY;

--
-- Name: competitions competitions_cd_insert; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY competitions_cd_insert ON public.competitions FOR INSERT TO authenticated WITH CHECK (((tenant_id = public.get_user_tenant_id()) AND (( SELECT user_profiles.role
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid())) = 'competition_director'::public.user_role)));


--
-- Name: competitions competitions_cd_update; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY competitions_cd_update ON public.competitions FOR UPDATE TO authenticated USING (((tenant_id = public.get_user_tenant_id()) AND (( SELECT user_profiles.role
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid())) = 'competition_director'::public.user_role)));


--
-- Name: competitions competitions_super_admin_all; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY competitions_super_admin_all ON public.competitions TO authenticated USING (public.is_super_admin());


--
-- Name: competitions competitions_user_select; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY competitions_user_select ON public.competitions FOR SELECT TO authenticated USING ((tenant_id = public.get_user_tenant_id()));


--
-- Name: dance_categories; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.dance_categories ENABLE ROW LEVEL SECURITY;

--
-- Name: dancers; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.dancers ENABLE ROW LEVEL SECURITY;

--
-- Name: dancers dancers_cd_select; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY dancers_cd_select ON public.dancers FOR SELECT TO authenticated USING (((tenant_id = public.get_user_tenant_id()) AND (( SELECT user_profiles.role
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid())) = 'competition_director'::public.user_role)));


--
-- Name: dancers dancers_sd_all; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY dancers_sd_all ON public.dancers TO authenticated USING (((tenant_id = public.get_user_tenant_id()) AND (studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.owner_id = auth.uid())))));


--
-- Name: dancers dancers_super_admin_all; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY dancers_super_admin_all ON public.dancers TO authenticated USING (public.is_super_admin());


--
-- Name: documents; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.documents ENABLE ROW LEVEL SECURITY;

--
-- Name: documents documents_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY documents_service_role ON public.documents TO service_role USING (true) WITH CHECK (true);


--
-- Name: documents documents_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY documents_tenant_isolation ON public.documents TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: elite_instructors; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.elite_instructors ENABLE ROW LEVEL SECURITY;

--
-- Name: email_logs; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.email_logs ENABLE ROW LEVEL SECURITY;

--
-- Name: email_logs email_logs_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY email_logs_service_role ON public.email_logs TO service_role USING (true) WITH CHECK (true);


--
-- Name: email_logs email_logs_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY email_logs_tenant_isolation ON public.email_logs TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: email_preferences; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.email_preferences ENABLE ROW LEVEL SECURITY;

--
-- Name: email_preferences email_preferences_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY email_preferences_service_role ON public.email_preferences TO service_role USING (true) WITH CHECK (true);


--
-- Name: email_preferences email_preferences_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY email_preferences_tenant_isolation ON public.email_preferences TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: email_queue; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.email_queue ENABLE ROW LEVEL SECURITY;

--
-- Name: email_templates; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.email_templates ENABLE ROW LEVEL SECURITY;

--
-- Name: email_templates email_templates_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY email_templates_service_role ON public.email_templates TO service_role USING (true) WITH CHECK (true);


--
-- Name: email_templates email_templates_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY email_templates_tenant_isolation ON public.email_templates TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: competition_entries entries_cd_select; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY entries_cd_select ON public.competition_entries FOR SELECT TO authenticated USING (((tenant_id = public.get_user_tenant_id()) AND (( SELECT user_profiles.role
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid())) = 'competition_director'::public.user_role)));


--
-- Name: competition_entries entries_sd_all; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY entries_sd_all ON public.competition_entries TO authenticated USING (((tenant_id = public.get_user_tenant_id()) AND (studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.owner_id = auth.uid())))));


--
-- Name: competition_entries entries_super_admin_all; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY entries_super_admin_all ON public.competition_entries TO authenticated USING (public.is_super_admin());


--
-- Name: entry_participants; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.entry_participants ENABLE ROW LEVEL SECURITY;

--
-- Name: entry_participants entry_participants_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY entry_participants_service_role ON public.entry_participants TO service_role USING (true) WITH CHECK (true);


--
-- Name: entry_participants entry_participants_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY entry_participants_tenant_isolation ON public.entry_participants TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: entry_size_categories; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.entry_size_categories ENABLE ROW LEVEL SECURITY;

--
-- Name: invoices; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.invoices ENABLE ROW LEVEL SECURITY;

--
-- Name: invoices invoices_cd_all; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY invoices_cd_all ON public.invoices TO authenticated USING (((tenant_id = public.get_user_tenant_id()) AND (( SELECT user_profiles.role
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid())) = 'competition_director'::public.user_role)));


--
-- Name: invoices invoices_sd_select; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY invoices_sd_select ON public.invoices FOR SELECT TO authenticated USING (((tenant_id = public.get_user_tenant_id()) AND (studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.owner_id = auth.uid())))));


--
-- Name: invoices invoices_super_admin_all; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY invoices_super_admin_all ON public.invoices TO authenticated USING (public.is_super_admin());


--
-- Name: judges; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.judges ENABLE ROW LEVEL SECURITY;

--
-- Name: scores judges_and_directors_can_view_scores; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY judges_and_directors_can_view_scores ON public.scores FOR SELECT USING (((judge_id IN ( SELECT judges.id
   FROM public.judges
  WHERE (judges.user_id = ( SELECT auth.uid() AS uid)))) OR (EXISTS ( SELECT 1
   FROM public.user_profiles
  WHERE ((user_profiles.id = ( SELECT auth.uid() AS uid)) AND (user_profiles.role = ANY (ARRAY['competition_director'::public.user_role, 'super_admin'::public.user_role])))))));


--
-- Name: scores judges_can_insert_own_scores; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY judges_can_insert_own_scores ON public.scores FOR INSERT WITH CHECK ((judge_id IN ( SELECT judges.id
   FROM public.judges
  WHERE (judges.user_id = ( SELECT auth.uid() AS uid)))));


--
-- Name: scores judges_can_update_own_scores; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY judges_can_update_own_scores ON public.scores FOR UPDATE USING ((judge_id IN ( SELECT judges.id
   FROM public.judges
  WHERE (judges.user_id = ( SELECT auth.uid() AS uid)))));


--
-- Name: judges judges_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY judges_service_role ON public.judges TO service_role USING (true) WITH CHECK (true);


--
-- Name: judges judges_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY judges_tenant_isolation ON public.judges TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: rankings; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.rankings ENABLE ROW LEVEL SECURITY;

--
-- Name: rankings rankings_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY rankings_service_role ON public.rankings TO service_role USING (true) WITH CHECK (true);


--
-- Name: rankings rankings_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY rankings_tenant_isolation ON public.rankings TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: reservations; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.reservations ENABLE ROW LEVEL SECURITY;

--
-- Name: reservations reservations_cd_all; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY reservations_cd_all ON public.reservations TO authenticated USING (((tenant_id = public.get_user_tenant_id()) AND (( SELECT user_profiles.role
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid())) = 'competition_director'::public.user_role)));


--
-- Name: reservations reservations_sd_all; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY reservations_sd_all ON public.reservations TO authenticated USING (((tenant_id = public.get_user_tenant_id()) AND (studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.owner_id = auth.uid())))));


--
-- Name: reservations reservations_super_admin_all; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY reservations_super_admin_all ON public.reservations TO authenticated USING (public.is_super_admin());


--
-- Name: routine_import_sessions; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.routine_import_sessions ENABLE ROW LEVEL SECURITY;

--
-- Name: routine_import_sessions routine_import_sessions_super_admin; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY routine_import_sessions_super_admin ON public.routine_import_sessions TO authenticated USING ((EXISTS ( SELECT 1
   FROM auth.users
  WHERE ((users.id = auth.uid()) AND ((users.raw_user_meta_data ->> 'role'::text) = 'super_admin'::text)))));


--
-- Name: routine_import_sessions routine_import_sessions_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY routine_import_sessions_tenant_isolation ON public.routine_import_sessions USING ((studio_id IN ( SELECT studios.id
   FROM public.studios
  WHERE (studios.tenant_id = (current_setting('app.current_tenant_id'::text, true))::uuid))));


--
-- Name: scores; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.scores ENABLE ROW LEVEL SECURITY;

--
-- Name: scores scores_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY scores_service_role ON public.scores TO service_role USING (true) WITH CHECK (true);


--
-- Name: scores scores_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY scores_tenant_isolation ON public.scores TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: scoring_tiers; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.scoring_tiers ENABLE ROW LEVEL SECURITY;

--
-- Name: studios; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.studios ENABLE ROW LEVEL SECURITY;

--
-- Name: studios studios_sd_insert; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY studios_sd_insert ON public.studios FOR INSERT TO authenticated WITH CHECK (((tenant_id = public.get_user_tenant_id()) AND (owner_id = auth.uid())));


--
-- Name: studios studios_sd_update; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY studios_sd_update ON public.studios FOR UPDATE TO authenticated USING (((tenant_id = public.get_user_tenant_id()) AND (owner_id = auth.uid())));


--
-- Name: studios studios_super_admin_all; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY studios_super_admin_all ON public.studios TO authenticated USING (public.is_super_admin());


--
-- Name: studios studios_user_select; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY studios_user_select ON public.studios FOR SELECT TO authenticated USING ((tenant_id = public.get_user_tenant_id()));


--
-- Name: summaries; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.summaries ENABLE ROW LEVEL SECURITY;

--
-- Name: summaries summaries_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY summaries_service_role ON public.summaries TO service_role USING (true) WITH CHECK (true);


--
-- Name: summaries summaries_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY summaries_tenant_isolation ON public.summaries TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: summary_entries; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.summary_entries ENABLE ROW LEVEL SECURITY;

--
-- Name: summary_entries summary_entries_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY summary_entries_service_role ON public.summary_entries TO service_role USING (true) WITH CHECK (true);


--
-- Name: summary_entries summary_entries_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY summary_entries_tenant_isolation ON public.summary_entries TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: system_settings; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.system_settings ENABLE ROW LEVEL SECURITY;

--
-- Name: tenants; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.tenants ENABLE ROW LEVEL SECURITY;

--
-- Name: tenants tenants_public_select; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY tenants_public_select ON public.tenants FOR SELECT TO anon USING (true);


--
-- Name: tenants tenants_super_admin_all; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY tenants_super_admin_all ON public.tenants TO authenticated USING (public.is_super_admin());


--
-- Name: tenants tenants_user_own; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY tenants_user_own ON public.tenants FOR SELECT TO authenticated USING ((id = public.get_user_tenant_id()));


--
-- Name: title_rounds; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.title_rounds ENABLE ROW LEVEL SECURITY;

--
-- Name: title_rounds title_rounds_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY title_rounds_service_role ON public.title_rounds TO service_role USING (true) WITH CHECK (true);


--
-- Name: title_rounds title_rounds_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY title_rounds_tenant_isolation ON public.title_rounds TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: two_factor_audit_log; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.two_factor_audit_log ENABLE ROW LEVEL SECURITY;

--
-- Name: user_profiles; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.user_profiles ENABLE ROW LEVEL SECURITY;

--
-- Name: user_profiles user_profiles_super_admin_all; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY user_profiles_super_admin_all ON public.user_profiles TO authenticated USING (public.is_super_admin());


--
-- Name: user_profiles user_profiles_user_insert; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY user_profiles_user_insert ON public.user_profiles FOR INSERT TO authenticated WITH CHECK ((id = auth.uid()));


--
-- Name: user_profiles user_profiles_user_select; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY user_profiles_user_select ON public.user_profiles FOR SELECT TO authenticated USING (((tenant_id = public.get_user_tenant_id()) OR (id = auth.uid())));


--
-- Name: user_profiles user_profiles_user_update; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY user_profiles_user_update ON public.user_profiles FOR UPDATE TO authenticated USING ((id = auth.uid()));


--
-- Name: vip_events; Type: ROW SECURITY; Schema: public; Owner: -
--

ALTER TABLE public.vip_events ENABLE ROW LEVEL SECURITY;

--
-- Name: vip_events vip_events_service_role; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY vip_events_service_role ON public.vip_events TO service_role USING (true) WITH CHECK (true);


--
-- Name: vip_events vip_events_tenant_isolation; Type: POLICY; Schema: public; Owner: -
--

CREATE POLICY vip_events_tenant_isolation ON public.vip_events TO authenticated USING ((tenant_id = ( SELECT user_profiles.tenant_id
   FROM public.user_profiles
  WHERE (user_profiles.id = auth.uid()))));


--
-- Name: messages; Type: ROW SECURITY; Schema: realtime; Owner: -
--

ALTER TABLE realtime.messages ENABLE ROW LEVEL SECURITY;

--
-- Name: buckets; Type: ROW SECURITY; Schema: storage; Owner: -
--

ALTER TABLE storage.buckets ENABLE ROW LEVEL SECURITY;

--
-- Name: buckets_analytics; Type: ROW SECURITY; Schema: storage; Owner: -
--

ALTER TABLE storage.buckets_analytics ENABLE ROW LEVEL SECURITY;

--
-- Name: migrations; Type: ROW SECURITY; Schema: storage; Owner: -
--

ALTER TABLE storage.migrations ENABLE ROW LEVEL SECURITY;

--
-- Name: objects; Type: ROW SECURITY; Schema: storage; Owner: -
--

ALTER TABLE storage.objects ENABLE ROW LEVEL SECURITY;

--
-- Name: prefixes; Type: ROW SECURITY; Schema: storage; Owner: -
--

ALTER TABLE storage.prefixes ENABLE ROW LEVEL SECURITY;

--
-- Name: s3_multipart_uploads; Type: ROW SECURITY; Schema: storage; Owner: -
--

ALTER TABLE storage.s3_multipart_uploads ENABLE ROW LEVEL SECURITY;

--
-- Name: s3_multipart_uploads_parts; Type: ROW SECURITY; Schema: storage; Owner: -
--

ALTER TABLE storage.s3_multipart_uploads_parts ENABLE ROW LEVEL SECURITY;

--
-- Name: supabase_realtime; Type: PUBLICATION; Schema: -; Owner: -
--

CREATE PUBLICATION supabase_realtime WITH (publish = 'insert, update, delete, truncate');


--
-- Name: supabase_realtime_messages_publication; Type: PUBLICATION; Schema: -; Owner: -
--

CREATE PUBLICATION supabase_realtime_messages_publication WITH (publish = 'insert, update, delete, truncate');


--
-- Name: supabase_realtime competition_entries; Type: PUBLICATION TABLE; Schema: public; Owner: -
--

ALTER PUBLICATION supabase_realtime ADD TABLE ONLY public.competition_entries;


--
-- Name: supabase_realtime competitions; Type: PUBLICATION TABLE; Schema: public; Owner: -
--

ALTER PUBLICATION supabase_realtime ADD TABLE ONLY public.competitions;


--
-- Name: supabase_realtime rankings; Type: PUBLICATION TABLE; Schema: public; Owner: -
--

ALTER PUBLICATION supabase_realtime ADD TABLE ONLY public.rankings;


--
-- Name: supabase_realtime reservations; Type: PUBLICATION TABLE; Schema: public; Owner: -
--

ALTER PUBLICATION supabase_realtime ADD TABLE ONLY public.reservations;


--
-- Name: supabase_realtime scores; Type: PUBLICATION TABLE; Schema: public; Owner: -
--

ALTER PUBLICATION supabase_realtime ADD TABLE ONLY public.scores;


--
-- Name: supabase_realtime_messages_publication messages; Type: PUBLICATION TABLE; Schema: realtime; Owner: -
--

ALTER PUBLICATION supabase_realtime_messages_publication ADD TABLE ONLY realtime.messages;


--
-- Name: issue_graphql_placeholder; Type: EVENT TRIGGER; Schema: -; Owner: -
--

CREATE EVENT TRIGGER issue_graphql_placeholder ON sql_drop
         WHEN TAG IN ('DROP EXTENSION')
   EXECUTE FUNCTION extensions.set_graphql_placeholder();


--
-- Name: issue_pg_cron_access; Type: EVENT TRIGGER; Schema: -; Owner: -
--

CREATE EVENT TRIGGER issue_pg_cron_access ON ddl_command_end
         WHEN TAG IN ('CREATE EXTENSION')
   EXECUTE FUNCTION extensions.grant_pg_cron_access();


--
-- Name: issue_pg_graphql_access; Type: EVENT TRIGGER; Schema: -; Owner: -
--

CREATE EVENT TRIGGER issue_pg_graphql_access ON ddl_command_end
         WHEN TAG IN ('CREATE FUNCTION')
   EXECUTE FUNCTION extensions.grant_pg_graphql_access();


--
-- Name: issue_pg_net_access; Type: EVENT TRIGGER; Schema: -; Owner: -
--

CREATE EVENT TRIGGER issue_pg_net_access ON ddl_command_end
         WHEN TAG IN ('CREATE EXTENSION')
   EXECUTE FUNCTION extensions.grant_pg_net_access();


--
-- Name: pgrst_ddl_watch; Type: EVENT TRIGGER; Schema: -; Owner: -
--

CREATE EVENT TRIGGER pgrst_ddl_watch ON ddl_command_end
   EXECUTE FUNCTION extensions.pgrst_ddl_watch();


--
-- Name: pgrst_drop_watch; Type: EVENT TRIGGER; Schema: -; Owner: -
--

CREATE EVENT TRIGGER pgrst_drop_watch ON sql_drop
   EXECUTE FUNCTION extensions.pgrst_drop_watch();


--
-- PostgreSQL database dump complete
--


